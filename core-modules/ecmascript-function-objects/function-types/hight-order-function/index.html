<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/javascript-guidebook/umi.b538b811.css" />
    <script>
      window.routerBase = "/javascript-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.3
    </script>
    <title>&#x9AD8;&#x9636;&#x51FD;&#x6570;</title>
  
<script>
      window.g_useSSR = true;
      window.g_initialProps = {};

    </script>
    </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/javascript-guidebook-favicon.png&#x27;)" href="/javascript-guidebook//">JavaScript Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/javascript-guidebook//basic-concept">基本语法</a><a href="/javascript-guidebook//standard-built-in-objects">内置对象</a><a aria-current="page" class="active" href="/javascript-guidebook//core-modules">核心模块</a><a href="/javascript-guidebook//object-oriented-programming">OOP</a><a href="/javascript-guidebook//browser-object-model">BOM</a><a href="/javascript-guidebook//document-object-model">DOM</a><a href="/javascript-guidebook//html5-scripting-programming">HTML5</a><a href="/javascript-guidebook//computer-networks">计算机网络</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/javascript-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/javascript-guidebook-favicon.png&#x27;)" href="/javascript-guidebook//"></a><h1>JavaScript Guidebook</h1><p>JavaScript 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/javascript-guidebook//basic-concept">基本语法</a></li><li><a href="/javascript-guidebook//standard-built-in-objects">内置对象</a></li><li><a aria-current="page" class="active" href="/javascript-guidebook//core-modules">核心模块</a></li><li><a href="/javascript-guidebook//object-oriented-programming">OOP</a></li><li><a href="/javascript-guidebook//browser-object-model">BOM</a></li><li><a href="/javascript-guidebook//document-object-model">DOM</a></li><li><a href="/javascript-guidebook//html5-scripting-programming">HTML5</a></li><li><a href="/javascript-guidebook//computer-networks">计算机网络</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/javascript-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/javascript-guidebook//core-modules">核心模块</a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/compilation">编译阶段</a><ul><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/compilation/compilation"><span>编译阶段</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/compilation/lexical-scope"><span>词法作用域</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/compilation/function-as-scopes"><span>函数作用域</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/compilation/blocks-as-scopes"><span>块作用域</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/compilation/hoisting"><span>声明提升</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/compilation/closures"><span>闭包</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution">执行阶段</a><ul><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/execution-context-stack"><span>执行上下文</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/variable-object"><span>变量对象</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/scope-chain"><span>作用域链</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/this"><span>this</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/memory-management">内存管理</a><ul><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/memory-management/memory-model"><span>内存模型</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/memory-management/memory-life-cycle"><span>内存生命周期</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/memory-management/garbage-collection"><span>垃圾回收</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/concurrency-model">并发模型</a><ul><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/concurrency-model/concurrency-model"><span>并发模型</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/concurrency-model/event-loop"><span>事件循环</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/concurrency-model/timers-mechanism"><span>定时器机制</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-declarations">函数声明</a><ul><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-declarations/function-definitions"><span>函数声明定义</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-declarations/arrow-function-definitions"><span>箭头函数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-declarations/async-function-definitions"><span>Async 函数</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-arguments">函数参数</a><ul><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-arguments/function-parameters"><span>函数参数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-arguments/default-parameters"><span>默认参数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-arguments/rest-parameters"><span>剩余参数</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-calls">函数调用</a><ul><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-calls/method-invocation-pattern"><span>方法调用模式</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-calls/function-invocation-pattern"><span>函数调用模式</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-calls/constructor-invocation-pattern"><span>构造函数调用模式</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-calls/apply-invocation-pattern"><span>间接调用模式</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-internal">函数内部</a><ul><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-internal/function-accessor"><span>函数存取器</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-internal/function-prototype-object-methods"><span>函数原型对象方法</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-internal/function-prototype-object-properties"><span>函数原型对象属性</span></a></li></ul></li><li><a aria-current="page" class="active" href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types">函数类型</a><ul><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/structure-function"><span>构造函数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/class-structure-function"><span>类构造函数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/lazy-function"><span>惰性函数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/cascade-function"><span>级联函数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/callback-function"><span>回调函数</span></a></li><li><a aria-current="page" class="active" href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/hight-order-function"><span>高阶函数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/function-currying"><span>函数柯里化</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/throttle"><span>函数节流</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/debounce"><span>函数防抖</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/memorize-function"><span>函数记忆</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/partial-function"><span>偏函数</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/modularization">模块化</a><ul><li><a href="/javascript-guidebook//core-modules/modularization/modularization"><span>模块化</span></a></li><li><a href="/javascript-guidebook//core-modules/modularization/import"><span>import</span></a></li><li><a href="/javascript-guidebook//core-modules/modularization/export"><span>export</span></a></li><li><a href="/javascript-guidebook//core-modules/modularization/compound"><span>复合写法</span></a></li><li><a href="/javascript-guidebook//core-modules/modularization/module-inheritance"><span>模块的继承</span></a></li><li><a href="/javascript-guidebook//core-modules/modularization/cross-module-constant"><span>跨模块常量</span></a></li><li><a href="/javascript-guidebook//core-modules/modularization/dynamic-import"><span>动态加载</span></a></li><li><a href="/javascript-guidebook//core-modules/modularization/module"><span>模块</span></a></li></ul></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="作为参数传递" data-depth="2" class=""><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/hight-order-function#作为参数传递"><span>作为参数传递</span></a></li><li title="回调函数" data-depth="3" class=""><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/hight-order-function#回调函数"><span>回调函数</span></a></li><li title="数组排序" data-depth="3" class=""><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/hight-order-function#数组排序"><span>数组排序</span></a></li><li title="作为返回值输出" data-depth="2" class=""><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/hight-order-function#作为返回值输出"><span>作为返回值输出</span></a></li><li title="AOP" data-depth="2" class=""><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/hight-order-function#aop"><span>AOP</span></a></li><li title="其他应用" data-depth="2" class=""><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/hight-order-function#其他应用"><span>其他应用</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="高阶函数"><a aria-hidden="true" href="#高阶函数"><span class="icon icon-link"></span></a>高阶函数</h1><p>高阶函数指操作函数的函数，一般地，有以下两种情况：</p><ol><li>函数可以作为参数被传递</li><li>函数可以作为返回值输出</li></ol><p>Javascript 中的函数显然满足高阶函数的条件，在实际开发中，无论是将函数当作参数传递，还是让函数的执行结果返回另外一个函数，这两种情形都有很多应用场景。</p><h2 id="作为参数传递"><a aria-hidden="true" href="#作为参数传递"><span class="icon icon-link"></span></a>作为参数传递</h2><p>把函数当作参数传递，代表可以抽离出一部分容易变化的业务逻辑，把这部分业务逻辑放在函数参数中，这样一来可以分离业务代码中变化与不变的部分。</p><h3 id="回调函数"><a aria-hidden="true" href="#回调函数"><span class="icon icon-link"></span></a>回调函数</h3><p>其中一个常见的应用场景就是回调函数。</p><ul><li>在 AJAX 异步请求的过程中，回调函数使用得非常频繁</li><li>在不确定请求返回的时间时，将 <code>callback</code> 回调函数当作参数传入</li><li>待请求完成后执行 <code>callback</code> 函数</li></ul><p>🌰 <strong>标准示例</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const getUserInfo = function( userId, callback ){
  $.ajax( &#x27;http://xx.com/getUserInfo?&#x27; + userId, function( data ){
    if ( typeof callback === &#x27;function&#x27; ){
      callback( data );
    }
  });
}

getUserInfo( 123, function( data ){
  console.log( data.userName );
});
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">getUserInfo</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token parameter">userId</span><span class="token parameter punctuation">,</span><span class="token parameter"> callback</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  $</span><span class="token punctuation">.</span><span class="token method function property-access">ajax</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token string">&#x27;http://xx.com/getUserInfo?&#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> userId</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token parameter">data</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token keyword">typeof</span><span class="token plain"> callback </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;function&#x27;</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token plain"> data </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token number">123</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token parameter">data</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain"> data</span><span class="token punctuation">.</span><span class="token property-access">userName</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>回调函数的应用不仅只在异步请求中，当一个函数不适合执行一些请求时，也可以把这些请求封装成一个函数，并把它作为参数传递给另外一个函数，<strong>委托</strong>给另外一个函数来执行。</p><p>比如，想在页面中创建 100 个 <code>div</code> 节点，然后把这些 <code>div</code> 节点都设置为隐藏。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const appendDiv = function(){
  for ( let i = 0; i &lt; 100; i++ ){
    const div = document.createElement( &#x27;div&#x27; );
    div.innerHTML = i;
    document.body.appendChild( div );
    div.style.display = &#x27;none&#x27;;
  }
};
appendDiv();
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">appendDiv</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token keyword">let</span><span class="token plain"> i </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token plain"> i </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation">;</span><span class="token plain"> i</span><span class="token operator">++</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> div </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token string">&#x27;div&#x27;</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    div</span><span class="token punctuation">.</span><span class="token property-access">innerHTML</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> i</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span><span class="token plain"> div </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    div</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">display</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;none&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">appendDiv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>把 <code>div.style.display = &#x27;none&#x27;</code> 的逻辑硬编码在 <code>appendDiv</code> 里显然是不合理的，<code>appendDiv</code> 未免有点个性化，成为了一个难以复用的函数，并不是每个人创建了节点之后就希望它们立刻被隐藏。</p><p>于是把 <code>div.style.display = &#x27;none&#x27;</code> 这行代码抽出来，用回调函数的形式传入 <code>appendDiv</code> 方法</p><div class="__dumi-default-code-block"><pre class="prism-code language-javascript"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const appendDiv = function( callback ){
  for ( let i = 0; i &lt; 100; i++ ){
    const div = document.createElement( &#x27;div&#x27; );
    div.innerHTML = i;
    document.body.appendChild( div );
    if ( typeof callback === &#x27;function&#x27; ){
      callback( div );
    }
  }
};

appendDiv(function( node ){
  node.style.display = &#x27;none&#x27;;
});
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">appendDiv</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token parameter">callback</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token keyword">let</span><span class="token plain"> i </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token plain"> i </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation">;</span><span class="token plain"> i</span><span class="token operator">++</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> div </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token string">&#x27;div&#x27;</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    div</span><span class="token punctuation">.</span><span class="token property-access">innerHTML</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> i</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span><span class="token plain"> div </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token keyword">typeof</span><span class="token plain"> callback </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;function&#x27;</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token plain"> div </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">appendDiv</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token parameter">node</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  node</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">display</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;none&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>可以看到，隐藏节点的请求实际上是由客户发起的，但是客户并不知道节点什么时候会创建好，于是把隐藏节点的逻辑放在回调函数中，<strong>委托</strong>给 <code>appendDiv</code> 方法。<code>appendDiv</code> 方法当然知道节点什么时候创建好，所以在节点创建好的时候，<code>appendDiv</code> 会执行之前客户传入的回调函数。</p><h3 id="数组排序"><a aria-hidden="true" href="#数组排序"><span class="icon icon-link"></span></a>数组排序</h3><p>函数作为参数传递的另一个常见场景是数组排序函数 <code>sort()</code>。<code>Array.prototype.sort</code> 接受一个函数当作参数，这个函数里面封装了数组元素的排序方法。目的是对数组进行排序，这是不变的部分；而使用什么规则去排序，则是可变的部分。把可变的部分封装在函数参数里，动态传入 <code>Array.prototype.sort</code>，使 <code>Array.prototype.sort</code> 方法成为了一个非常灵活的方法。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// 从小到大排列，输出: [ 1, 3, 4 ]
[ 1, 4, 3 ].sort( function( a, b ){
  return a - b;
});

// 从大到小排列，输出: [ 4, 3, 1 ]
[ 1, 4, 3 ].sort( function( a, b ){
  return b - a;
});
" data-status="copy"></button><div class="token-line"><span class="token comment">// 从小到大排列，输出: [ 1, 3, 4 ]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain"> </span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token parameter">a</span><span class="token parameter punctuation">,</span><span class="token parameter"> b</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> a </span><span class="token operator">-</span><span class="token plain"> b</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 从大到小排列，输出: [ 4, 3, 1 ]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain"> </span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token parameter">a</span><span class="token parameter punctuation">,</span><span class="token parameter"> b</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> b </span><span class="token operator">-</span><span class="token plain"> a</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="作为返回值输出"><a aria-hidden="true" href="#作为返回值输出"><span class="icon icon-link"></span></a>作为返回值输出</h2><p>相比把函数当作参数传递，函数当作返回值输出的应用场景也有很多。让函数继续返回一个可执行的函数，意味着运算过程是可延续的。</p><p>下面是使用 <code>Object.prototype.toString</code> 方法判断数据类型的一系列的 <code>isType</code> 函数</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="let isString = function( obj ){
  return Object.prototype.toString.call( obj ) === &#x27;[object String]&#x27;;
};

let isArray = function( obj ){
  return Object.prototype.toString.call( obj ) === &#x27;[object Array]&#x27;;
};

let isNumber = function( obj ){
  return Object.prototype.toString.call( obj ) === &#x27;[object Number]&#x27;;
};
" data-status="copy"></button><div class="token-line"><span class="token keyword">let</span><span class="token plain"> </span><span class="token function-variable function">isString</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token parameter">obj</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token plain"> obj </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;[object String]&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> </span><span class="token function-variable function">isArray</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token parameter">obj</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token plain"> obj </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;[object Array]&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> </span><span class="token function-variable function">isNumber</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token parameter">obj</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token plain"> obj </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;[object Number]&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>实际上，这些函数的大部分实现都是相同的，不同的只是 <code>Object.prototype.toString.call(obj)</code> 返回的字符串。为了避免多余的代码，可以把这些字符串作为参数提前传入 <code>isType</code> 函数。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="let isType = function( type ){
  return function( obj ){
    return Object.prototype.toString.call( obj ) === &#x27;[object &#x27;+ type +&#x27;]&#x27;;
  }
};

const isString = isType( &#x27;String&#x27; );
const isArray = isType( &#x27;Array&#x27; );
const isNumber = isType( &#x27;Number&#x27; );

console.log( isArray( [ 1, 2, 3 ] ) );      // 输出：true
" data-status="copy"></button><div class="token-line"><span class="token keyword">let</span><span class="token plain"> </span><span class="token function-variable function">isType</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token parameter">type</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token parameter">obj</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token plain"> obj </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;[object &#x27;</span><span class="token operator">+</span><span class="token plain"> type </span><span class="token operator">+</span><span class="token string">&#x27;]&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> isString </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">isType</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token string">&#x27;String&#x27;</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> isArray </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">isType</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token string">&#x27;Array&#x27;</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> isNumber </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">isType</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token string">&#x27;Number&#x27;</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain"> </span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain">      </span><span class="token comment">// 输出：true</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>其实上面实现的 isType 函数，也属于<strong>偏函数</strong>的范畴，偏函数实际上是返回了一个包含<strong>预处理参数</strong>的新函数，以便后续逻辑可以调用。</p><p>当然，还可以用循环语句，来批量注册这些 <code>isType</code> 函数：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="let Type = {};
for ( var i = 0, type; type = [ &#x27;String&#x27;, &#x27;Array&#x27;, &#x27;Number&#x27; ][ i++ ]; ){
  (function( type ){
    Type[ &#x27;is&#x27; + type ] = function( obj ){
      return Object.prototype.toString.call( obj ) === &#x27;[object &#x27;+ type +&#x27;]&#x27;;
    }
  })( type )
};

Type.isArray( [] );         // 输出：true
Type.isString( &quot;str&quot; );     // 输出：true
" data-status="copy"></button><div class="token-line"><span class="token keyword">let</span><span class="token plain"> </span><span class="token maybe-class-name">Type</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token keyword">var</span><span class="token plain"> i </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> type</span><span class="token punctuation">;</span><span class="token plain"> type </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token string">&#x27;String&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;Array&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;Number&#x27;</span><span class="token plain"> </span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token plain"> i</span><span class="token operator">++</span><span class="token plain"> </span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token parameter">type</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token maybe-class-name">Type</span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token string">&#x27;is&#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> type </span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token parameter">obj</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token plain"> obj </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;[object &#x27;</span><span class="token operator">+</span><span class="token plain"> type </span><span class="token operator">+</span><span class="token string">&#x27;]&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain"> type </span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">Type</span><span class="token punctuation">.</span><span class="token method function property-access">isArray</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain">         </span><span class="token comment">// 输出：true</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">Type</span><span class="token punctuation">.</span><span class="token method function property-access">isString</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token string">&quot;str&quot;</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain">     </span><span class="token comment">// 输出：true</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="aop"><a aria-hidden="true" href="#aop"><span class="icon icon-link"></span></a>AOP</h2><p>AOP 即面向切面编程，它的主要作用是<strong>把一些跟核心业务逻辑模块无关的功能抽离出来</strong>，这些跟业务逻辑无关的功能通常包括日志统计、安全控制、异常处理等。把这些功能抽离出来之后，再通过 <strong>动态织入</strong> 的方式掺入业务逻辑模块中。这样做的好处首先是可以保持业务逻辑模块的纯净和高内聚性，其次是可以很方便地复用日志统计等功能模块。</p><p>通常，在 Javascript 中实现 AOP，都是指把一个函数“动态织入”到另外一个函数之中。下面通过扩展 <code>Function.prototype</code> 来实现</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Function.prototype.before = function (beforefn) {
    // 保存原函数的引用
    const _this = this;
    // 返回包含了原函数和新函数的&quot;代理&quot;函数
    return function () {
        // 先执行新函数，修正 this
        beforefn.apply(this, arguments);
        // 再执行原函数
        return _this.apply(this, arguments);
    }
};

Function.prototype.after = function (afterfn) {
    const _this = this;
    return function () {
        // 先执行原函数
        const ret = _this.apply(this, arguments);
        // 再执行新函数
        afterfn.apply(this, arguments);
        return ret;
    }
};

const func = function () {
    console.log(2);
};

func = func.before(function () {
    console.log(1);
}).after(function () {
    console.log(3);
});

func();
// 1 2 3
" data-status="copy"></button><div class="token-line"><span class="token class-name">Function</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">before</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">beforefn</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 保存原函数的引用</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> _this </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 返回包含了原函数和新函数的&quot;代理&quot;函数</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">// 先执行新函数，修正 this</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        beforefn</span><span class="token punctuation">.</span><span class="token method function property-access">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token plain"> arguments</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">// 再执行原函数</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">return</span><span class="token plain"> _this</span><span class="token punctuation">.</span><span class="token method function property-access">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token plain"> arguments</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token class-name">Function</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">after</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">afterfn</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> _this </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">// 先执行原函数</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">const</span><span class="token plain"> ret </span><span class="token operator">=</span><span class="token plain"> _this</span><span class="token punctuation">.</span><span class="token method function property-access">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token plain"> arguments</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">// 再执行新函数</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        afterfn</span><span class="token punctuation">.</span><span class="token method function property-access">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token plain"> arguments</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">return</span><span class="token plain"> ret</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">func</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">func </span><span class="token operator">=</span><span class="token plain"> func</span><span class="token punctuation">.</span><span class="token method function property-access">before</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">after</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 1 2 3</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>把负责打印数字 1 和打印数字 3 的两个函数通过 AOP 的方式动态植入 <code>func</code> 函数。通过执行上面的代码，控制台顺利地返回了执行结果 1、2、3。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const service = function (){
    console.log(&#x27;功能逻辑&#x27;);
}

const test = (function (){
    let start_time;
    return {
        before: function (){
            start_time = new Date();
            console.log(&#x27;计时开始&#x27;);
        },
        after: function (){
            const end_time = (new Date()) - start_time;
            console.log(&#x27;计时结束，用时：&#x27; + end_time)
        }
    }
})();

const aop = function(fn, proxy){
    proxy.before &amp;&amp; proxy.before();
    fn();
    proxy.after &amp;&amp; proxy.after();
}

aop(service, test);
// 计时开始
// 功能逻辑
// 计时结束：1
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">service</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;功能逻辑&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> test </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">let</span><span class="token plain"> start_time</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function-variable function">before</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            start_time </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;计时开始&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function-variable function">after</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token keyword">const</span><span class="token plain"> end_time </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> start_time</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;计时结束，用时：&#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> end_time</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">aop</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token parameter punctuation">,</span><span class="token parameter"> proxy</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    proxy</span><span class="token punctuation">.</span><span class="token property-access">before</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> proxy</span><span class="token punctuation">.</span><span class="token method function property-access">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    proxy</span><span class="token punctuation">.</span><span class="token property-access">after</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> proxy</span><span class="token punctuation">.</span><span class="token method function property-access">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">aop</span><span class="token punctuation">(</span><span class="token plain">service</span><span class="token punctuation">,</span><span class="token plain"> test</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 计时开始</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 功能逻辑</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 计时结束：1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="其他应用"><a aria-hidden="true" href="#其他应用"><span class="icon icon-link"></span></a>其他应用</h2><ul><li><a href="function-currying.md">函数柯里化</a></li><li><a href="function-currying.md#%E5%8F%8D%E6%9F%AF%E9%87%8C%E5%8C%96">反柯里化</a></li><li><a href="throttle.md">函数节流</a></li><li><a href="debounce">函数防抖</a></li><li>分时函数</li><li>惰性加载</li></ul><hr/><p><strong>参考资料：</strong></p><ul><li><a href="https://juejin.im/entry/5815876c8ac247004fb6d132" target="_blank" rel="noopener noreferrer">📝 高阶函数介绍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/javascript-guidebook/edit/master/docs/core-modules/ecmascript-function-objects/function-types/hight-order-function.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">6/24/2020, 4:19:42 PM</span></div></div></div></div>

    <script src="/javascript-guidebook/umi.7263cbe3.js"></script>
    <script src="/javascript-guidebook/docs__core-modules__ecmascript-function-objects__function-types__hight-order-function.md.61ff8e93.async.js"></script>
  </body>
</html>
