<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/javascript-guidebook/umi.css" />
    <script>
      window.routerBase = "/javascript-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.19
    </script>
    <title>惰性函数</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/javascript-guidebook-favicon.png&#x27;)" href="/javascript-guidebook//">JavaScript Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/javascript-guidebook//basic-concept">基本语法</a><a href="/javascript-guidebook//standard-built-in-objects">内置对象</a><a aria-current="page" class="active" href="/javascript-guidebook//core-modules">核心模块</a><a href="/javascript-guidebook//object-oriented-programming">OOP</a><a href="/javascript-guidebook//browser-object-model">BOM</a><a href="/javascript-guidebook//document-object-model">DOM</a><a href="/javascript-guidebook//computer-networks">计算机网络</a><a href="/javascript-guidebook//design-patterns">设计模式</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/javascript-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/javascript-guidebook-favicon.png&#x27;)" href="/javascript-guidebook//"></a><h1>JavaScript Guidebook</h1><p>JavaScript 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/javascript-guidebook//basic-concept">基本语法</a></li><li><a href="/javascript-guidebook//standard-built-in-objects">内置对象</a></li><li><a aria-current="page" class="active" href="/javascript-guidebook//core-modules">核心模块</a></li><li><a href="/javascript-guidebook//object-oriented-programming">OOP</a></li><li><a href="/javascript-guidebook//browser-object-model">BOM</a></li><li><a href="/javascript-guidebook//document-object-model">DOM</a></li><li><a href="/javascript-guidebook//computer-networks">计算机网络</a></li><li><a href="/javascript-guidebook//design-patterns">设计模式</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/javascript-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/javascript-guidebook//core-modules">核心模块</a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/compilation">编译阶段</a><ul><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/compilation/compilation"><span>编译阶段</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/compilation/lexical-scope"><span>词法作用域</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/compilation/function-as-scopes"><span>函数作用域</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/compilation/blocks-as-scopes"><span>块作用域</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/compilation/hoisting"><span>声明提升</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/compilation/closures"><span>闭包</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution">执行阶段</a><ul><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/execution-context-stack"><span>执行上下文</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/variable-object"><span>变量对象</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/scope-chain"><span>作用域链</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/this"><span>this</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/memory-management">内存管理</a><ul><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/memory-management/memory-model"><span>内存模型</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/memory-management/memory-life-cycle"><span>内存生命周期</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/memory-management/garbage-collection"><span>垃圾回收</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/concurrency-model">并发模型</a><ul><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/concurrency-model/concurrency-model"><span>并发模型</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/concurrency-model/event-loop"><span>事件循环</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/concurrency-model/timers-mechanism"><span>定时器机制</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-declarations">函数声明</a><ul><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-declarations/function-definitions"><span>函数声明定义</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-declarations/arrow-function-definitions"><span>箭头函数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-declarations/async-function-definitions"><span>异步函数</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-arguments">函数参数</a><ul><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-arguments/function-parameters"><span>函数参数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-arguments/default-parameters"><span>默认参数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-arguments/rest-parameters"><span>剩余参数</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-calls">函数调用</a><ul><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-calls/method-invocation-pattern"><span>方法调用模式</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-calls/function-invocation-pattern"><span>函数调用模式</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-calls/constructor-invocation-pattern"><span>构造函数调用模式</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-calls/apply-invocation-pattern"><span>间接调用模式</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-internal">函数内部</a><ul><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-internal/function-accessor"><span>函数存取器</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-internal/function-prototype-object-methods"><span>函数原型对象方法</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-internal/function-prototype-object-properties"><span>函数原型对象属性</span></a></li></ul></li><li><a aria-current="page" class="active" href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types">函数类型</a><ul><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/structure-function"><span>构造函数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/class-structure-function"><span>类构造函数</span></a></li><li><a aria-current="page" class="active" href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/lazy-function"><span>惰性函数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/cascade-function"><span>级联函数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/callback-function"><span>回调函数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/hight-order-function"><span>高阶函数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/function-currying"><span>函数柯里化</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/throttle"><span>函数节流</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/debounce"><span>函数防抖</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/memorize-function"><span>函数记忆</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/partial-function"><span>偏函数</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/modularization">模块化</a><ul><li><a href="/javascript-guidebook//core-modules/modularization/modularization"><span>模块化</span></a></li><li><a href="/javascript-guidebook//core-modules/modularization/import"><span>模块导入 import</span></a></li><li><a href="/javascript-guidebook//core-modules/modularization/export"><span>模块导出 export</span></a></li><li><a href="/javascript-guidebook//core-modules/modularization/compound"><span>模块导入/导出的复合写法</span></a></li><li><a href="/javascript-guidebook//core-modules/modularization/module-inheritance"><span>模块继承</span></a></li><li><a href="/javascript-guidebook//core-modules/modularization/cross-module-constant"><span>跨模块常量</span></a></li><li><a href="/javascript-guidebook//core-modules/modularization/dynamic-import"><span>动态加载</span></a></li></ul></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="解决问题" data-depth="2" class=""><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/lazy-function#解决问题"><span>解决问题</span></a></li><li title="函数重写" data-depth="2" class=""><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/lazy-function#函数重写"><span>函数重写</span></a></li><li title="惰性载入" data-depth="2" class=""><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/lazy-function#惰性载入"><span>惰性载入</span></a></li><li title="在函数被调用时处理函数" data-depth="3" class=""><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/lazy-function#在函数被调用时处理函数"><span>在函数被调用时处理函数</span></a></li><li title="声明函数时指定适当的函数" data-depth="3" class=""><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/lazy-function#声明函数时指定适当的函数"><span>声明函数时指定适当的函数</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="惰性函数"><a aria-hidden="true" href="#惰性函数"><span class="icon icon-link"></span></a>惰性函数</h1><p><strong>惰性函数</strong> 表示函数执行的分支只会在函数 <strong>第一次调用</strong> 的时候执行，在第一次调用过程中，该函数会被覆盖为另一个按照合适方式执行的函数，这样任何对原函数的调用就不用再经过执行的分支了。</p><h2 id="解决问题"><a aria-hidden="true" href="#解决问题"><span class="icon icon-link"></span></a>解决问题</h2><p>在一个方法里面可能会涉及到一些兼容性的问题，不同的浏览器对应不同的方法，第一次我们遍历这些方法找到最合适的那个， 并将这个方法覆盖于遍历它的函数，这就是惰性函数即只遍历一次就找到最佳方案，下次再要找那个方法的时候就不用遍历了，提高了性能。</p><p>🌰 <strong>示例：常见的为 DOM 节点添加事件的函数</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function addEvent(type, element, func) {
  if (element.addEventListener) {
    element.addEventListener(type, func, false);
  } else if(element.attachEvent){
    element.attachEvent(&#x27;on&#x27; + type, func);
  } else{
    element[&#x27;on&#x27; + type] = func;
  }
}
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">addEvent</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token parameter punctuation">,</span><span class="token parameter"> element</span><span class="token parameter punctuation">,</span><span class="token parameter"> func</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">element</span><span class="token punctuation">.</span><span class="token property-access">addEventListener</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    element</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token plain">type</span><span class="token punctuation">,</span><span class="token plain"> func</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token plain">element</span><span class="token punctuation">.</span><span class="token property-access">attachEvent</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    element</span><span class="token punctuation">.</span><span class="token method function property-access">attachEvent</span><span class="token punctuation">(</span><span class="token string">&#x27;on&#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> type</span><span class="token punctuation">,</span><span class="token plain"> func</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    element</span><span class="token punctuation">[</span><span class="token string">&#x27;on&#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> type</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> func</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>每次调用 <code>addEvent</code> 函数的时候，它都要对浏览器所支持的能力进行检查，首先检查是否支持 <code>addEventListener</code> 方法，如果不支持，再检查是否支持 <code>attachEvent</code> 方法，如果还不支持，就用 DOM0 级的方法添加事件。这个过程，在 <code>addEvent</code> 函数每次调用的时候都要走一遍，其实，如果浏览器支持其中的一种方法，那么他就会一直支持了，就没有必要再进行其他分支的检测了，也就是说，<code>if</code> 语句不必每次都执行，代码可以运行的更快一些。解决的方案就是称之为 <strong>惰性载入</strong> 的技巧。</p><h2 id="函数重写"><a aria-hidden="true" href="#函数重写"><span class="icon icon-link"></span></a>函数重写</h2><p>在介绍惰性函数（或称惰性载入）之前，首先介绍函数重写技术。</p><p>由于一个函数可以返回另一个函数，因此可以用新的函数来覆盖旧的函数。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function foo(){
  console.log(&#x27;foo&#x27;);

  foo = function(){
    console.log(&#x27;bar&#x27;);
  }
}
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;foo&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function-variable function">foo</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;bar&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>这样一来，第一次调用该函数时会 <code>console.log(&#x27;foo&#x27;)</code> 会被执行，全局变量 <code>foo</code> 被重定义，并被赋予新的函数。当该函数再次被调用时，<code>console.log(&#x27;bar&#x27;)</code> 会被执行。</p><h2 id="惰性载入"><a aria-hidden="true" href="#惰性载入"><span class="icon icon-link"></span></a>惰性载入</h2><p>惰性函数的本质就是函数重写。所谓<strong>惰性载入</strong>，就是说函数执行的分支只会执行一次，之后调用函数时，直接进入所支持的分支代码。</p><p>有两种实现惰性载入的方式，第一种事函数在第一次调用时，对函数本身进行二次处理，该函数会被覆盖为符合分支条件的函数，这样对原函数的调用就不用再经过执行的分支了，我们可以用下面的方式使用惰性载入重写<code>addEvent()</code>。</p><h3 id="在函数被调用时处理函数"><a aria-hidden="true" href="#在函数被调用时处理函数"><span class="icon icon-link"></span></a>在函数被调用时处理函数</h3><p>函数在第一次调用时，该函数会被覆盖为另外一个按合适方式执行的函数，这样任何对原函数的调用都不用再经过执行的分支了。代码重写如下</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function addEvent(type, element, func) {
  if (element.addEventListener) {
    addEvent = function (type, element, func) {
      element.addEventListener(type, func, false);
    }
  } else if(element.attachEvent){
    addEvent = function (type, element, func) {
      element.attachEvent(&#x27;on&#x27; + type, func);
    }
  } else{
    addEvent = function (type, element, func) {
      element[&#x27;on&#x27; + type] = func;
    }
  }

  return addEvent(type, element, func);
}
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">addEvent</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token parameter punctuation">,</span><span class="token parameter"> element</span><span class="token parameter punctuation">,</span><span class="token parameter"> func</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">element</span><span class="token punctuation">.</span><span class="token property-access">addEventListener</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function-variable function">addEvent</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token parameter punctuation">,</span><span class="token parameter"> element</span><span class="token parameter punctuation">,</span><span class="token parameter"> func</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      element</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token plain">type</span><span class="token punctuation">,</span><span class="token plain"> func</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token plain">element</span><span class="token punctuation">.</span><span class="token property-access">attachEvent</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function-variable function">addEvent</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token parameter punctuation">,</span><span class="token parameter"> element</span><span class="token parameter punctuation">,</span><span class="token parameter"> func</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      element</span><span class="token punctuation">.</span><span class="token method function property-access">attachEvent</span><span class="token punctuation">(</span><span class="token string">&#x27;on&#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> type</span><span class="token punctuation">,</span><span class="token plain"> func</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function-variable function">addEvent</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token parameter punctuation">,</span><span class="token parameter"> element</span><span class="token parameter punctuation">,</span><span class="token parameter"> func</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      element</span><span class="token punctuation">[</span><span class="token string">&#x27;on&#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> type</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> func</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">addEvent</span><span class="token punctuation">(</span><span class="token plain">type</span><span class="token punctuation">,</span><span class="token plain"> element</span><span class="token punctuation">,</span><span class="token plain"> func</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>在这个惰性载入的 <code>addEvent()</code> 中，<code>if</code> 语句的每个分支都会为 <code>addEvent</code> 变量赋值，有效覆盖了原函数。最后一步便是调用了新赋函数。下一次调用 <code>addEvent()</code> 时，便会直接调用新赋值的函数，这样就不用再执行 <code>if</code> 语句了。</p><p>但是，这种方法有个缺点，如果函数名称有所改变，修改起来比较麻烦。</p><h3 id="声明函数时指定适当的函数"><a aria-hidden="true" href="#声明函数时指定适当的函数"><span class="icon icon-link"></span></a>声明函数时指定适当的函数</h3><p>把嗅探浏览器的操作提前到代码加载的时候，在代码加载的时候就立刻进行一次判断，以便让 <code>addEvent</code> 返回一个包裹了正确逻辑的函数。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="var addEvent = (function () {
  if (document.addEventListener) {
    return function (type, element, func) {
      element.addEventListener(type, func, false);
    }
  }
  else if (document.attachEvent) {
    return function (type, element, func) {
      element.attachEvent(&#x27;on&#x27; + type, func);
    }
  }
  else {
    return function (type, element, func) {
      element[&#x27;on&#x27; + type] = func;
    }
  }
})();
" data-status="copy"></button><div class="token-line"><span class="token keyword">var</span><span class="token plain"> addEvent </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">addEventListener</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token parameter punctuation">,</span><span class="token parameter"> element</span><span class="token parameter punctuation">,</span><span class="token parameter"> func</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      element</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token plain">type</span><span class="token punctuation">,</span><span class="token plain"> func</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">attachEvent</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token parameter punctuation">,</span><span class="token parameter"> element</span><span class="token parameter punctuation">,</span><span class="token parameter"> func</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      element</span><span class="token punctuation">.</span><span class="token method function property-access">attachEvent</span><span class="token punctuation">(</span><span class="token string">&#x27;on&#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> type</span><span class="token punctuation">,</span><span class="token plain"> func</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token parameter punctuation">,</span><span class="token parameter"> element</span><span class="token parameter punctuation">,</span><span class="token parameter"> func</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      element</span><span class="token punctuation">[</span><span class="token string">&#x27;on&#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> type</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> func</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/javascript-guidebook/edit/master/docs/core-modules/ecmascript-function-objects/function-types/lazy-function.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">9/8/2020, 2:03:02 PM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/javascript-guidebook/umi.js"></script>
    <script src="/javascript-guidebook/docs__core-modules__ecmascript-function-objects__function-types__lazy-function.md.js"></script>
  </body>
</html>
