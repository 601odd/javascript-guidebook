<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/javascript-guidebook/umi.css" />
    <script>
      window.routerBase = "/javascript-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.22
    </script>
    <title>this</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/javascript-guidebook-favicon.png&#x27;)" href="/javascript-guidebook//">JavaScript Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/javascript-guidebook//basic-concept">基本语法</a><a href="/javascript-guidebook//standard-built-in-objects">内置对象</a><a aria-current="page" class="active" href="/javascript-guidebook//core-modules">核心模块</a><a href="/javascript-guidebook//object-oriented-programming">OOP</a><a href="/javascript-guidebook//browser-object-model">BOM</a><a href="/javascript-guidebook//document-object-model">DOM</a><a href="/javascript-guidebook//computer-networks">计算机网络</a><a href="/javascript-guidebook//design-patterns">设计模式</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/javascript-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/javascript-guidebook-favicon.png&#x27;)" href="/javascript-guidebook//"></a><h1>JavaScript Guidebook</h1><p>JavaScript 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/javascript-guidebook//basic-concept">基本语法</a></li><li><a href="/javascript-guidebook//standard-built-in-objects">内置对象</a></li><li><a aria-current="page" class="active" href="/javascript-guidebook//core-modules">核心模块</a></li><li><a href="/javascript-guidebook//object-oriented-programming">OOP</a></li><li><a href="/javascript-guidebook//browser-object-model">BOM</a></li><li><a href="/javascript-guidebook//document-object-model">DOM</a></li><li><a href="/javascript-guidebook//computer-networks">计算机网络</a></li><li><a href="/javascript-guidebook//design-patterns">设计模式</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/javascript-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/javascript-guidebook//core-modules">核心模块</a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/compilation">编译阶段</a><ul><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/compilation/compilation"><span>编译阶段</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/compilation/lexical-scope"><span>词法作用域</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/compilation/function-as-scopes"><span>函数作用域</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/compilation/blocks-as-scopes"><span>块作用域</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/compilation/hoisting"><span>声明提升</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/compilation/closures"><span>闭包</span></a></li></ul></li><li><a aria-current="page" class="active" href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution">执行阶段</a><ul><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/execution-context-stack"><span>执行上下文</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/variable-object"><span>变量对象</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/scope-chain"><span>作用域链</span></a></li><li><a aria-current="page" class="active" href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/this"><span>this</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/memory-management">内存管理</a><ul><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/memory-management/memory-model"><span>内存模型</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/memory-management/memory-life-cycle"><span>内存生命周期</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/memory-management/garbage-collection"><span>垃圾回收</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/concurrency-model">并发模型</a><ul><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/concurrency-model/concurrency-model"><span>并发模型</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/concurrency-model/event-loop"><span>事件循环</span></a></li><li><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/concurrency-model/timers-mechanism"><span>定时器机制</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-declarations">函数声明</a><ul><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-declarations/function-definitions"><span>函数声明定义</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-declarations/arrow-function-definitions"><span>箭头函数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-declarations/async-function-definitions"><span>异步函数</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-arguments">函数参数</a><ul><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-arguments/function-parameters"><span>函数参数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-arguments/default-parameters"><span>默认参数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-arguments/rest-parameters"><span>剩余参数</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-calls">函数调用</a><ul><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-calls/method-invocation-pattern"><span>方法调用模式</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-calls/function-invocation-pattern"><span>函数调用模式</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-calls/constructor-invocation-pattern"><span>构造函数调用模式</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-calls/apply-invocation-pattern"><span>间接调用模式</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-internal">函数内部</a><ul><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-internal/function-accessor"><span>函数存取器</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-internal/function-prototype-object-methods"><span>函数原型对象方法</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-internal/function-prototype-object-properties"><span>函数原型对象属性</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types">函数类型</a><ul><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/structure-function"><span>构造函数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/class-structure-function"><span>类构造函数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/lazy-function"><span>惰性函数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/cascade-function"><span>级联函数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/callback-function"><span>回调函数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/hight-order-function"><span>高阶函数</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/function-currying"><span>函数柯里化</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/throttle"><span>函数节流</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/debounce"><span>函数防抖</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/memorize-function"><span>函数记忆</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/sleep-function"><span>函数睡眠</span></a></li><li><a href="/javascript-guidebook//core-modules/ecmascript-function-objects/function-types/partial-function"><span>偏函数</span></a></li></ul></li><li><a href="/javascript-guidebook//core-modules/modularization">模块化</a><ul><li><a href="/javascript-guidebook//core-modules/modularization/modularization"><span>模块化</span></a></li><li><a href="/javascript-guidebook//core-modules/modularization/import"><span>模块导入 import</span></a></li><li><a href="/javascript-guidebook//core-modules/modularization/export"><span>模块导出 export</span></a></li><li><a href="/javascript-guidebook//core-modules/modularization/compound"><span>模块导入/导出的复合写法</span></a></li><li><a href="/javascript-guidebook//core-modules/modularization/module-inheritance"><span>模块继承</span></a></li><li><a href="/javascript-guidebook//core-modules/modularization/cross-module-constant"><span>跨模块常量</span></a></li><li><a href="/javascript-guidebook//core-modules/modularization/dynamic-import"><span>动态加载</span></a></li></ul></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="调用位置" data-depth="2" class=""><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/this#调用位置"><span>调用位置</span></a></li><li title="绑定规则" data-depth="2" class=""><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/this#绑定规则"><span>绑定规则</span></a></li><li title="默认绑定" data-depth="3" class=""><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/this#默认绑定"><span>默认绑定</span></a></li><li title="隐式绑定" data-depth="3" class=""><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/this#隐式绑定"><span>隐式绑定</span></a></li><li title="显式绑定" data-depth="3" class=""><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/this#显式绑定"><span>显式绑定</span></a></li><li title="new 绑定" data-depth="3" class=""><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/this#new-绑定"><span>new 绑定</span></a></li><li title="优先级" data-depth="2" class=""><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/this#优先级"><span>优先级</span></a></li><li title="隐式绑定和显式绑定" data-depth="3" class=""><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/this#隐式绑定和显式绑定"><span>隐式绑定和显式绑定</span></a></li><li title="new 绑定和隐式绑定" data-depth="3" class=""><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/this#new-绑定和隐式绑定"><span>new 绑定和隐式绑定</span></a></li><li title="绑定例外" data-depth="2" class=""><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/this#绑定例外"><span>绑定例外</span></a></li><li title="忽略指向" data-depth="3" class=""><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/this#忽略指向"><span>忽略指向</span></a></li><li title="软绑定" data-depth="3" class=""><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/this#软绑定"><span>软绑定</span></a></li><li title="指向变更" data-depth="3" class=""><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/this#指向变更"><span>指向变更</span></a></li><li title="箭头函数" data-depth="2" class=""><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/this#箭头函数"><span>箭头函数</span></a></li><li title="应用场景总结" data-depth="2" class=""><a href="/javascript-guidebook//core-modules/executable-code-and-execution-contexts/execution/this#应用场景总结"><span>应用场景总结</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="this"><a aria-hidden="true" href="#this"><span class="icon icon-link"></span></a>this</h1><h2 id="调用位置"><a aria-hidden="true" href="#调用位置"><span class="icon icon-link"></span></a>调用位置</h2><p>在理解 <code>this</code> 的绑定过程之前，首先要理解 <code>this</code> 的<strong>调用位置</strong>：调用位置就是函数在代码中被调用的位置（而不是声明的位置）。</p><p>而要理解 <code>this</code> 的调用位置，最重要的是要 <strong>分析调用栈</strong>（就是为了到达当前执行位置所调用的所有函数）。我们关心的调用位置就在当前正在执行的函数的前一个调用中。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function baz() {
  // 当前调用栈是：baz
  // 因此，当前调用位置是全局作用域
  console.log(&#x27;baz&#x27;);
  bar(); // &lt;-- bar 的调用的位置
}

function bar() {
  // 当前调用栈是 baz -&gt; bar
  // 因此，当前调用调用位置在 baz 中
  console.log(&#x27;bar&#x27;);
  foo(); // &lt;-- foo 的调用位置
}

function foo() {
  // 当前调用栈是 baz -&gt; bar -&gt; foo
  // 因此，当前调用位置在 bar 中
  console.log(&#x27;foo&#x27;);
}

baz(); // &lt;-- baz 的调用位置
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 当前调用栈是：baz</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 因此，当前调用位置是全局作用域</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;baz&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// &lt;-- bar 的调用的位置</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 当前调用栈是 baz -&gt; bar</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 因此，当前调用调用位置在 baz 中</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;bar&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// &lt;-- foo 的调用位置</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 当前调用栈是 baz -&gt; bar -&gt; foo</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 因此，当前调用位置在 bar 中</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;foo&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// &lt;-- baz 的调用位置</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>注意我们是如何从调用栈中分析出真正的调用位置，因为它决定了 <code>this</code> 的绑定。</p><h2 id="绑定规则"><a aria-hidden="true" href="#绑定规则"><span class="icon icon-link"></span></a>绑定规则</h2><p>函数的执行过程中调用位置决定 <code>this</code> 的 <strong>绑定对象</strong>。</p><p>你必须找到调用位置，然后判断需要应用下面四条规则中的哪一条。我们首先会分别解释这四条规则，然后解释多条规则都可用时它们的优先级如何排列。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="调用栈 =&gt; 调用位置 =&gt; 绑定规则 =&gt; 规则优先级;
" data-status="copy"></button><div class="token-line"><span class="token parameter">调用栈</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token parameter">调用位置</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token parameter">绑定规则</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> 规则优先级</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="默认绑定"><a aria-hidden="true" href="#默认绑定"><span class="icon icon-link"></span></a>默认绑定</h3><p>首先要介绍的是最常用的函数调用类型：<strong>独立函数调用</strong>。可以把这条规则看作是无法应用其他规则时的默认规则。</p><p>🌰 <strong>标准示例：</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function foo() {
  console.log(this.a);
}

// 声明在全局作用域中的变量就是全局对象的一个同名属性
// 相当于 window.a = 2
var a = 2;

// 调用 foo 函数时 this.a 被解析成了全局变量 a
// 因为在本例中，函数调用时应用了 this 的默认绑定
// 因此 this 指向全局对象 global objects 或 window objects
// 分析调用位置来获知 foo 是如何调用的
// foo 函数直接使用不带任何修饰的函数引用进行调用，因此只能使用默认绑定，无法应用其他规则
foo();
// 2
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 声明在全局作用域中的变量就是全局对象的一个同名属性</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 相当于 window.a = 2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> a </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 调用 foo 函数时 this.a 被解析成了全局变量 a</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 因为在本例中，函数调用时应用了 this 的默认绑定</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 因此 this 指向全局对象 global objects 或 window objects</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 分析调用位置来获知 foo 是如何调用的</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// foo 函数直接使用不带任何修饰的函数引用进行调用，因此只能使用默认绑定，无法应用其他规则</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>如果使用严格模式（Strict Mode），则不能将全局对象用于默认绑定，因此 <code>this</code> 会绑定到 <code>undefined</code>。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function foo() {
  &#x27;use strict&#x27;;

  console.log(this.a);
}

var a = 2;

foo();
// TypeError:this is undefined
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token string">&#x27;use strict&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> a </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// TypeError:this is undefined</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>这里有一个微妙但是非常重要的细节，虽然 <code>this</code> 的绑定规则完全取决于调用位置，但是只有 <code>foo()</code> 运行在非严格模式下时，默认绑定才能绑定到全局对象；在严格模式下调用 <code>foo</code> 则不受默认绑定影响。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function foo() {
  console.log(this.a);
}

var a = 2;

(function foo() {
  &#x27;use strict&#x27;;

  foo(); // 2
})();
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> a </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token string">&#x27;use strict&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// 2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>⚠️ <strong>注意</strong>：通常来说你不应该在代码中混合使用严格模式和非严格模式。整个程序要么严格要么非严格。然而，有时候你可能会用到第三方库，其严格程度和你代码有所不同，因此一定要注意这类兼容性细节。</p><h3 id="隐式绑定"><a aria-hidden="true" href="#隐式绑定"><span class="icon icon-link"></span></a>隐式绑定</h3><p>另一条需要考虑的规则是调用位置是否有<strong>上下文对象</strong>，或者说是否<strong>被某个对象拥有或者包含</strong>，不过这种说法可能会造成一些误导。</p><p>🌰 <strong>标准示例：</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function foo() {
  console.log(this.a);
}

const container = {
  a: 2,
  foo: foo,
};

container.foo(); // 2
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> container </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  a</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  foo</span><span class="token punctuation">:</span><span class="token plain"> foo</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">container</span><span class="token punctuation">.</span><span class="token method function property-access">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// 2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>首先需要注意的是 <code>foo</code> 的声明方式，及其之后是如何被当作引用属性添加到 <code>container</code> 中的。但是无论是直接在 <code>container</code> 中定义还是先定义再添加为引用属性，这个函数严格来说都不属于 <code>container</code> 对象。</p><p>然而，调用位置会使用 <code>container</code> 上下文来引用函数，因此你可以说函数被调用时 <code>container</code> 对象 <strong>拥有</strong> 或者 <strong>包含</strong> 它。</p><p>无论你如何称呼这个模式，当 <code>foo</code> 被调用时，它的前面确实加上了对 <code>container</code> 的引用。当函数引用有上下文时，隐式绑定规则会把函数调用中的 <code>this</code> 绑定到这个上下文对象。因为调用 <code>foo</code> 时 <code>this</code> 被绑定到 <code>container</code> 上，因此 <code>this.a</code> 和 <code>container.a</code> 是一样的。</p><p>💡 <strong>对象属性引用链中只有上一层或最后一层在调用位置中起作用。</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function foo() {
  console.log(this.a);
}

var obj2 = {
  a: 42,
  foo: foo,
};

var obj1 = {
  a: 2,
  obj2: obj2,
};

obj1.obj2.foo(); // 42
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> obj2 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  a</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">42</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  foo</span><span class="token punctuation">:</span><span class="token plain"> foo</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> obj1 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  a</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  obj2</span><span class="token punctuation">:</span><span class="token plain"> obj2</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">obj1</span><span class="token punctuation">.</span><span class="token property-access">obj2</span><span class="token punctuation">.</span><span class="token method function property-access">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// 42</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h4 id="隐式丢失"><a aria-hidden="true" href="#隐式丢失"><span class="icon icon-link"></span></a>隐式丢失</h4><p>一个最常见的 <code>this</code> 绑定问题就是<strong>被隐式绑定的函数会丢失绑定对象</strong>，也就是说它会应用默认绑定，从而把 <code>this</code> 绑定到全局对象或者 <code>undefined</code> 上（这取决于是否是严格模式）。</p><p>🌰 <strong>标准示例：</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function foo() {
  console.log(this.a);
}

const container = {
  a: 2,
  foo: foo,
};

// 函数别名
const bar = container.foo;

// a 是全局对象的属性
const a = &#x27;Hello world!&#x27;;

bar();
// &quot;Hello world!&quot;
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> container </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  a</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  foo</span><span class="token punctuation">:</span><span class="token plain"> foo</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 函数别名</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> bar </span><span class="token operator">=</span><span class="token plain"> container</span><span class="token punctuation">.</span><span class="token property-access">foo</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// a 是全局对象的属性</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> a </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;Hello world!&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// &quot;Hello world!&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>📍 虽然 <code>bar</code> 是 <code>container.foo</code> 的一个引用，但是实际上，它引用的是 <code>foo</code> 函数本身，因此此时的 <code>bar</code> 其实是一个不带任何修饰的函数调用，因此应用了默认绑定。</p><p>一种更微妙、更常见并且更出乎意料的情况发生在传入回调函数时。</p><p>🌰 <strong>标准示例：</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function foo() {
  console.log(this.a);
}

function bar(fn) {
  // fn 其实引用的是 foo
  fn(); // &lt;--调用位置
}

var container = {
  a: 2,
  foo: foo,
};

// a 是全局对象的属性
var a = &#x27;Hello world!&#x27;;

bar(container.foo);
// &quot;Hello world!&quot;
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// fn 其实引用的是 foo</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// &lt;--调用位置</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> container </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  a</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  foo</span><span class="token punctuation">:</span><span class="token plain"> foo</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// a 是全局对象的属性</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> a </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;Hello world!&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token plain">container</span><span class="token punctuation">.</span><span class="token property-access">foo</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// &quot;Hello world!&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>参数传递其实是一种<strong>隐式赋值</strong>，因此我们传入函数时也会被隐式赋值，所以结果和上个示例一样。</p><p>如果把函数传入语言内置的函数而不是传入你自己声明的函数，结果是一样的，没有区别。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function foo() {
  console.log(this.a);
}

const container = {
  a: 2,
  foo: foo,
};

// a 是全局对象的属性
var a = &#x27;Hello world!&#x27;;

setTimeout(container.foo, 100);
// &#x27;Hello world!&#x27;
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> container </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  a</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  foo</span><span class="token punctuation">:</span><span class="token plain"> foo</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// a 是全局对象的属性</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> a </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;Hello world!&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token plain">container</span><span class="token punctuation">.</span><span class="token property-access">foo</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// &#x27;Hello world!&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>回调函数丢失 <code>this</code> 绑定是非常常见的。</p><p>除此之外，还有一种情况 <code>this</code> 的行为会出乎我们意料：调用回调函数的函数可能会修改 <code>this</code>。在一些流行的 JavaScript 库中事件处理器会把回调函数的 <code>this</code> 强制绑定到触发事件的 DOM 元素上。这在一些情况下可能很有用，但是有时它可能会让你感到非常郁闷。遗憾的是，这些工具通常无法选择是否启用这个行为。</p><p>无论是哪种情况，<code>this</code> 的改变都是意想不到的，实际上你无法控制回调函数的执行方式，因此就没有办法控制调用位置以得到期望的绑定。之后我们会介绍如何通过固定 <code>this</code> 来修复这个问题。</p><h3 id="显式绑定"><a aria-hidden="true" href="#显式绑定"><span class="icon icon-link"></span></a>显式绑定</h3><p>就像我们刚才看到的那样，在分析隐式绑定时，我们必须在一个对象内部包含一个指向函数的属性，并通过这个属性间接引用函数，从而把 <code>this</code> 隐式绑定到该对象上。</p><p>JavaScript 提供了 <code>apply</code>、<code>call</code> 和 <code>bind</code> 方法，为创建的所有函数绑定宿主环境。通过这些方法绑定函数的 <code>this</code> 指向称为<strong>显式绑定</strong>。</p><h4 id="硬绑定"><a aria-hidden="true" href="#硬绑定"><span class="icon icon-link"></span></a>硬绑定</h4><p>硬绑定可以解决之前提出的丢失绑定的问题。</p><p>🌰 <strong>标准示例：</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function foo() {
  console.log(ths.a);
}

const container = {
  a: 2,
};

var bar = function() {
  foo.call(container);
};

bar();
// 2

setTimeout(bar, 100);
// 2

// 硬绑定的 bar 不可能再修改它的 this
bar.call(window);
// 2
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">ths</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> container </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  a</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> </span><span class="token function-variable function">bar</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  foo</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token plain">container</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token plain">bar</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 硬绑定的 bar 不可能再修改它的 this</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">bar</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>我们创建了函数 <code>bar</code>，并在它的内部手动调用了 <code>foo.call(container)</code> ，因此强制把 <code>foo</code> 的 <code>this</code> 绑定到了 <code>container</code> 。无论之后如何调用函数 <code>bar</code>，它总会手动在 <code>container</code> 上调用 <code>foo</code>。这种绑定是一种显式（手动）的强制绑定，因此我们称之为<strong>硬绑定</strong>。</p><h4 id="内置函数"><a aria-hidden="true" href="#内置函数"><span class="icon icon-link"></span></a>内置函数</h4><p>第三方库的许多函数，以及 JavaScript 语言和宿主环境中许多新的内置函数，都提供了一个可选的参数，通常被称为 <strong>上下文（context）</strong>，其作用和 <code>bind</code> 一样，确保你的回调函数使用指定的 <code>this</code> 。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function foo(item) {
  console.log(this.title, item);
}

const columns = {
  title: &#x27;No:&#x27;,
}[
  // 调用 foo 时把 this 绑定到 columns
  (1, 2, 3)
].forEach(foo, columns);
// No:1 No:2 No:3
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">,</span><span class="token plain"> item</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> columns </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  title</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;No:&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 调用 foo 时把 this 绑定到 columns</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token plain">foo</span><span class="token punctuation">,</span><span class="token plain"> columns</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// No:1 No:2 No:3</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>这些函数实际上就是通过 <code>call</code> 或者 <code>apply</code> 实现了显式绑定，这样代码会更加优雅。</p><h3 id="new-绑定"><a aria-hidden="true" href="#new-绑定"><span class="icon icon-link"></span></a>new 绑定</h3><p>在 JavaScript 中，构造函数只是使用 <code>new</code> 操作符时被调用的函数。它们并不会属于某个类，也不会实例化一个类，实际上，它们甚至都不能说是一种特殊的函数类型，它们只是被 <code>new</code> 操作符调用的普通函数而已。</p><p>举例来说，思考一下 <code>Number()</code> 作为构造函数时的行为，ES5.1 中这样描述它：</p><blockquote><p>15.7.2 Number 构造函数</p><p>当 Number 在 new 表达式中被调用时，它是一个构造函数：它会初始化新创建的对象。</p></blockquote><p>所以，包括内置对象函数在内的所有函数都可以用 <code>new</code> 来调用，这种函数调用被称为<strong>构造函数调用</strong>。这里有一个重要但是非常细微的区别：实际上并不存在所谓的构造函数，只是对于函数的 <strong>构造调用</strong>。</p><p>🎉 使用 <code>new</code> 来调用函数，或者说发生构造函数调用时，会自动执行下面的操作。</p><ol><li>创建全新的空对象</li><li>将新对象的隐式原型对象关联构造函数的显式原型对象</li><li>执行对象类的构造函数，同时该实例的属性和方法被 <code>this</code> 所引用，即 <code>this</code> 指向新构造的实例</li><li>如果构造函数执行后没有返回其他对象，那么 <code>new</code> 表达式中的函数调用会自动返回这个新对象</li></ol><p>🎯 <strong>模拟过程：</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function objectFactory(constructor, ...rest) {
  // 创建空对象，空对象关联构造函数的原型对象
  const instance = Object.create(constructor.prototype);

  // 执行对象类的构造函数，同时该实例的属性和方法被 this 所引用，即 this 指向新构造的实例
  const result = constructor.call(instance, rest);

  // 判断构造函数的运行结果是否对象类型
  if (result !== null &amp;&amp; /^(object|function)$/.test(typeof result)) {
    return result;
  }

  return instance;
}
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">objectFactory</span><span class="token punctuation">(</span><span class="token parameter">constructor</span><span class="token parameter punctuation">,</span><span class="token parameter"> </span><span class="token parameter operator">...</span><span class="token parameter">rest</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 创建空对象，空对象关联构造函数的原型对象</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> instance </span><span class="token operator">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token plain">constructor</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 执行对象类的构造函数，同时该实例的属性和方法被 this 所引用，即 this 指向新构造的实例</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> result </span><span class="token operator">=</span><span class="token plain"> constructor</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token plain">instance</span><span class="token punctuation">,</span><span class="token plain"> rest</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 判断构造函数的运行结果是否对象类型</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">result </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token regex">/^(object|function)$/</span><span class="token punctuation">.</span><span class="token method function property-access">test</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token plain"> result</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> result</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> instance</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>解剖内部操作后，我们能得出结论 <code>new</code> 操作符是为了实现该过程的一种<strong>语法糖</strong>。</p><h2 id="优先级"><a aria-hidden="true" href="#优先级"><span class="icon icon-link"></span></a>优先级</h2><p>上文介绍了函数调用中 <code>this</code> 绑定的四条规则，你需要做的就是找到函数的调用位置并判断应用哪条规则。但是，如果某个调用位置应用多条规则，则必须给这些规则设定优先级。</p><p>毫无疑问，默认绑定的优先级是四条规则中最低的，所以我们先不考虑它。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="显式绑定 &gt; new 绑定() &gt; 隐式绑定;
" data-status="copy"></button><div class="token-line"><span class="token plain">显式绑定 </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token function">绑定</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&gt;</span><span class="token plain"> 隐式绑定</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="隐式绑定和显式绑定"><a aria-hidden="true" href="#隐式绑定和显式绑定"><span class="icon icon-link"></span></a>隐式绑定和显式绑定</h3><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function foo() {
  console.log(this.a);
}

const container1 = {
  a: 1,
  foo: foo,
};

const container2 = {
  a: 2,
  foo: foo,
};

container1.foo();
// 1
container2.foo();
// 2

container1.foo.call(container2);
// 2
container2.foo.call(container1);
// 1
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> container1 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  a</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  foo</span><span class="token punctuation">:</span><span class="token plain"> foo</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> container2 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  a</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  foo</span><span class="token punctuation">:</span><span class="token plain"> foo</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">container1</span><span class="token punctuation">.</span><span class="token method function property-access">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">container2</span><span class="token punctuation">.</span><span class="token method function property-access">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">container1</span><span class="token punctuation">.</span><span class="token method function property-access">foo</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token plain">container2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">container2</span><span class="token punctuation">.</span><span class="token method function property-access">foo</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token plain">container1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>可以看到，显式绑定优先级更高，也就是说在判断时应当先考虑是否可以存在显式绑定。</p><h3 id="new-绑定和隐式绑定"><a aria-hidden="true" href="#new-绑定和隐式绑定"><span class="icon icon-link"></span></a>new 绑定和隐式绑定</h3><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function foo(something) {
  this.a = something;
}

const container1 = {
  foo: foo,
};

const container2 = {};

container1.foo(2);
console.log(container1.a);
// 2

container1.foo(container2, 3);
console.log(container2.a);
// 3

var bar = new container1.foo(4);
console.log(container1.a);
// 2
console.log(bar.a);
// 4
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">something</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> something</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> container1 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  foo</span><span class="token punctuation">:</span><span class="token plain"> foo</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> container2 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">container1</span><span class="token punctuation">.</span><span class="token method function property-access">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">container1</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">container1</span><span class="token punctuation">.</span><span class="token method function property-access">foo</span><span class="token punctuation">(</span><span class="token plain">container2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">container2</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 3</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> bar </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">container1</span><span class="token class-name punctuation">.</span><span class="token class-name">foo</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">container1</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">bar</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 4</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>可以看到 <code>new</code> 绑定比隐式绑定优先级高。但是 <code>new</code> 绑定和显式绑定谁的优先级更高呢？</p><p><code>new</code> 和 <code>call/apply</code> 无法一起使用，因此无法通过 <code>new foo.call(obj1)</code> 来直接进行测试。但是我们可以使用硬绑定来测试他俩的优先级。</p><p>在看代码之前先回忆一下硬绑定是如何工作的。<code>Function.prototype.bind</code> 会创建一个新的包装函数，这个函数会忽略它当前的 <code>this</code> 绑定（无论绑定的对象是什么），并把我们提供的对象绑定到 <code>this</code> 上。</p><p>这样看起来硬绑定（也是显式绑定的一种）似乎比 <code>new</code> 绑定的优先级更高，无法使用 <code>new</code> 来控制 <code>this</code> 绑定。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function foo(something) {
  this.a = something;
}

var container1 = {};

var bar = foo.bind(container1);
bar(2);
console.log(container1.a);
// 2

var baz = new bar(3);
console.log(container1.a);
// 2
console.log(baz.a);
// 3
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">something</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> something</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> container1 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> bar </span><span class="token operator">=</span><span class="token plain"> foo</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token plain">container1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">container1</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> baz </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">bar</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">container1</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">baz</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 3</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="绑定例外"><a aria-hidden="true" href="#绑定例外"><span class="icon icon-link"></span></a>绑定例外</h2><h3 id="忽略指向"><a aria-hidden="true" href="#忽略指向"><span class="icon icon-link"></span></a>忽略指向</h3><p>如果将 <code>null</code> 或 <code>undefined</code> 作为 <code>this</code> 的绑定对象传入 <code>call</code>、<code>apply</code> 或 <code>bind</code>，这些值在调用时会被忽略，实际应用的是默认绑定规则。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function foo() {
  console.log(this.a);
}

const a = 2;

foo.call(null);
// 2
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> a </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">foo</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>此类写法常用于 <code>apply</code> 来展开数组，并当作参数传入一个函数，类似地，<code>bind</code> 可以对参数进行柯里化（预先设置一些参数）。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function foo(a, b) {
  console.log(&#x27;a:&#x27; + a + &#x27;,b:&#x27; + b);
}

// 把数组展开成参数
foo.apply(null, [2, 3]);
// a:2, b:3

// 使用 bind 进行柯里化
var bar = foo.bind(null, 2);
bar(3);
// a:2, b:3
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token parameter punctuation">,</span><span class="token parameter"> b</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;a:&#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> a </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string">&#x27;,b:&#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 把数组展开成参数</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">foo</span><span class="token punctuation">.</span><span class="token method function property-access">apply</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// a:2, b:3</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 使用 bind 进行柯里化</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> bar </span><span class="token operator">=</span><span class="token plain"> foo</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// a:2, b:3</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>这两种方法都需要传入一个参数当作 <code>this</code> 的绑定对象。如果函数并不关心 <code>this</code> 的话，你 仍然需要传入一个占位值，这时 <code>null</code> 可能是一个不错的选择。</p><h3 id="软绑定"><a aria-hidden="true" href="#软绑定"><span class="icon icon-link"></span></a>软绑定</h3><p>硬绑定这种方式可以把 <code>this</code> 强制绑定到指定的对象（除了使用 <code>new</code> 时），防止函数调用应用默认绑定规则。问题在于，硬绑定会大大降低函数的灵活性，使用硬绑定之后就无法使用隐式绑定或者显式绑定来修改 <code>this</code>。</p><p>如果可以给默认绑定指定一个全局对象和 <code>undefined</code> 以外的值，那就可以实现和硬绑定相同的效果，同时保留隐式绑定或者显式绑定修改 <code>this</code> 的能力。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="if (!Function.prototype.softBind) { Function.prototype.softBind = function(obj) {
var fn = this;
// 捕获所有 curried 参数
var curried = [].slice.call( arguments, 1 ); var bound = function() {
return fn.apply(
(!this || this === (window || global)) ?
obj : this
curried.concat.apply( curried, arguments )
); };
             bound.prototype = Object.create( fn.prototype );
return bound; };
}
" data-status="copy"></button><div class="token-line"><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Function</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token property-access">softBind</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token class-name">Function</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">softBind</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> fn </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 捕获所有 curried 参数</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> curried </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">slice</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token plain"> arguments</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token keyword">var</span><span class="token plain"> </span><span class="token function-variable function">bound</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">return</span><span class="token plain"> fn</span><span class="token punctuation">.</span><span class="token method function property-access">apply</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"> global</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">obj </span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">curried</span><span class="token punctuation">.</span><span class="token method function property-access">concat</span><span class="token punctuation">.</span><span class="token method function property-access">apply</span><span class="token punctuation">(</span><span class="token plain"> curried</span><span class="token punctuation">,</span><span class="token plain"> arguments </span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">             bound</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token plain"> fn</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">return</span><span class="token plain"> bound</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="指向变更"><a aria-hidden="true" href="#指向变更"><span class="icon icon-link"></span></a>指向变更</h3><p>如下列出四种方法可以在编码中改变 <code>this</code> 指向。</p><ul><li>使用 ES6 的箭头函数</li><li>在函数内部使用 <code>_this = this</code></li><li>使用 <code>apply</code>、<code>call</code> 和 <code>bind</code></li><li><code>new</code> 实例化一个对象</li></ul><h2 id="箭头函数"><a aria-hidden="true" href="#箭头函数"><span class="icon icon-link"></span></a>箭头函数</h2><p>箭头函数并不是使用 <code>function</code> 关键字定义的，而是使用被称为胖箭头的操作符 <code>=&gt;</code> 定义的。箭头函数不使用 <code>this</code> 的四种标准规则，而是根据外层（函数或者全局）作用域来决定 <code>this</code>。并且，箭头函数拥有静态的上下文，即一次绑定之后，便不可再修改。</p><p><code>this</code> 指向的固定化，并不是因为箭头函数内部有绑定 <code>this</code> 的机制，实际原因是箭头函数根本没有自己的 <code>this</code>，导致内部的 <code>this</code> 就是外层代码块的 <code>this</code>。正是因为它没有 <code>this</code>，所以也就不能用作构造函数。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function foo() {
  // 返回一个箭头函数
  return a =&gt; {
    // this 继承自 foo()
    console.log(this.a);
  };
}
const container1 = { a: 1 };

const container2 = { a: 2 };

const bar = foo.call(container1);

bar.call(container2);
// 1
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 返回一个箭头函数</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token parameter">a</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// this 继承自 foo()</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> container1 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> a</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> container2 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> a</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> bar </span><span class="token operator">=</span><span class="token plain"> foo</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token plain">container1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">bar</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token plain">container2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>foo</code> 内部创建的箭头函数会捕获调用时 <code>foo</code> 的 <code>this</code>。由于 <code>foo</code> 的 <code>this</code> 绑定到 <code>container1</code>，<code>bar</code>（引用箭头函数）的 <code>this</code> 也会绑定到 <code>con1</code>，箭头函数的绑定无法被修改。(<code>new</code> 也不 行）</p><p>箭头函数可以像 <code>bind</code> 一样确保函数的 <code>this</code> 被绑定到指定对象，此外，其重要性还体现在它用更常见的词法作用域取代了传统的 <code>this</code> 机制。实际上，在 ES6 之前我们就已经在使用一种几乎和箭头函数完全一样的模式。</p><p>虽然 <code>self = this</code> 和箭头函数看起来都可以取代 <code>bind</code>，但是从本质上来说，它们想替代的是 <code>this</code> 机制。</p><p>如果你经常编写 <code>this</code> 风格的代码，但是绝大部分时候都会使用 <code>self = this</code> 或者箭头函数来否定 <code>this</code> 机制，那你或许应当:</p><ul><li>只使用词法作用域并完全抛弃错误 <code>this</code> 风格的代码</li><li>完全采用 <code>this</code> 风格，在必要时使用 <code>bind</code>，尽量避免使用 <code>self = this</code> 和箭头函数</li></ul><h2 id="应用场景总结"><a aria-hidden="true" href="#应用场景总结"><span class="icon icon-link"></span></a>应用场景总结</h2><ol><li>函数的普通调用</li><li>函数作为对象方法调用</li><li>函数作为构造函数调用</li><li>函数通过 call、apply、bind 间接调用</li><li>箭头函数的调用</li></ol><hr/><p><strong>参考资料：</strong></p><ul><li><a href="https://github.com/getify/You-Dont-Know-JS/blob/master/this%20%26%20object%20prototypes/README" target="_blank" rel="noopener noreferrer">📚 你不知道的 JavaScript（上卷）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://zhuanlan.zhihu.com/p/23804247" target="_blank" rel="noopener noreferrer">📝 this 的值到底是什么？一次说清楚<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/7" target="_blank" rel="noopener noreferrer">📝 JavaScript 深入之从 ECMAScript 规范解读 this<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://github.com/logan70/Blog/issues/27" target="_blank" rel="noopener noreferrer">作用域与闭包 - this 的原理以及几种不同使用场景的取值<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/javascript-guidebook/edit/master/docs/core-modules/executable-code-and-execution-contexts/execution/this.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">9/28/2020, 8:15:31 PM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/javascript-guidebook/umi.js"></script>
    <script src="/javascript-guidebook/docs__core-modules__executable-code-and-execution-contexts__execution__this.md.js"></script>
  </body>
</html>
