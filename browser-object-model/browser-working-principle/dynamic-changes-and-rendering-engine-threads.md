## 动态变化和渲染引擎的线程

### 动态变化

在发生变化时，浏览器会尽可能做出最小的响应：

- 元素颜色的改变：只会对该元素进行**重绘**。
- 元素位置的改变：只会对该元素及其子元素（可能还有同级元素）进行**布局和重绘**。
- 添加 DOM 节点：会对该节点进行**布局和重绘**。
- 一些重大变化（例如增大 `<html>` 元素的字体）会导致缓存无效，使得整个渲染树都会进行重新布局和绘制。

### 渲染引擎的线程

渲染引擎是单线程的，除了网络操作以外，几乎所有的事情都在单一的线程中处理，在 Firefox 和 Safari 中，该线程就是浏览器的主线程，而在Chrome 中，该线程是标签页（Tab）的主线程。

网络操作可由多个并行线程执行，并行连接的个数是受限的（通常是 2 至 6 个，以 Firefox 3 为例是 6 个）。

#### 事件循环

浏览器的主线程是事件循环。它是一个无限循环，永远处于接受处理状态，并等待事件（如布局和绘制事件）发生，并进行处理。这是 Firefox 中关于主事件循环的代码：

```c++
while (!mExiting)
    NS_ProcessNextEvent(thread);
```



