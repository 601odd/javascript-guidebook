<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/javascript-guidebook/umi.css" />
    <script>
      window.routerBase = "/javascript-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.22
    </script>
    <title>IntersectionObserver API</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/javascript-guidebook-favicon.png&#x27;)" href="/javascript-guidebook//">JavaScript Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/javascript-guidebook//basic-concept">基本语法</a><a href="/javascript-guidebook//standard-built-in-objects">内置对象</a><a href="/javascript-guidebook//core-modules">核心模块</a><a href="/javascript-guidebook//object-oriented-programming">OOP</a><a aria-current="page" class="active" href="/javascript-guidebook//browser-object-model">BOM</a><a href="/javascript-guidebook//document-object-model">DOM</a><a href="/javascript-guidebook//computer-networks">计算机网络</a><a href="/javascript-guidebook//design-patterns">设计模式</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/javascript-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/javascript-guidebook-favicon.png&#x27;)" href="/javascript-guidebook//"></a><h1>JavaScript Guidebook</h1><p>JavaScript 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/javascript-guidebook//basic-concept">基本语法</a></li><li><a href="/javascript-guidebook//standard-built-in-objects">内置对象</a></li><li><a href="/javascript-guidebook//core-modules">核心模块</a></li><li><a href="/javascript-guidebook//object-oriented-programming">OOP</a></li><li><a aria-current="page" class="active" href="/javascript-guidebook//browser-object-model">BOM</a></li><li><a href="/javascript-guidebook//document-object-model">DOM</a></li><li><a href="/javascript-guidebook//computer-networks">计算机网络</a></li><li><a href="/javascript-guidebook//design-patterns">设计模式</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/javascript-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/javascript-guidebook//browser-object-model">BOM 浏览器对象模型</a></li><li><a href="/javascript-guidebook//browser-object-model/window">全局对象</a><ul><li><a href="/javascript-guidebook//browser-object-model/window/window"><span>Window 对象</span></a></li><li><a href="/javascript-guidebook//browser-object-model/window/location"><span>Location 对象</span></a></li><li><a href="/javascript-guidebook//browser-object-model/window/history"><span>History 对象</span></a></li><li><a href="/javascript-guidebook//browser-object-model/window/screen"><span>Screen 对象</span></a></li><li><a href="/javascript-guidebook//browser-object-model/window/navigator"><span>Navigator 对象</span></a></li></ul></li><li><a href="/javascript-guidebook//browser-object-model/web-event">全局 API</a><ul><li><a href="/javascript-guidebook//browser-object-model/web-event/set-interval"><span>setInterval 间歇调用</span></a></li><li><a href="/javascript-guidebook//browser-object-model/web-event/set-time-out"><span>setTimeout 超时调用</span></a></li><li><a href="/javascript-guidebook//browser-object-model/web-event/alert"><span>alert</span></a></li><li><a href="/javascript-guidebook//browser-object-model/web-event/confirm"><span>confirm</span></a></li><li><a href="/javascript-guidebook//browser-object-model/web-event/prompt"><span>prompt</span></a></li><li><a href="/javascript-guidebook//browser-object-model/web-event/drag-and-drop-api"><span>拖放 API</span></a></li><li><a href="/javascript-guidebook//browser-object-model/web-event/request-animation-frame"><span>动画 API</span></a></li></ul></li><li><a href="/javascript-guidebook//browser-object-model/window-position">视窗尺寸位置</a><ul><li><a href="/javascript-guidebook//browser-object-model/window-position/window-view-properties"><span>Window 对象视图属性</span></a></li><li><a href="/javascript-guidebook//browser-object-model/window-position/screen-view-properties"><span>Screen 对象视图属性</span></a></li><li><a href="/javascript-guidebook//browser-object-model/window-position/element-view-properties"><span>Element 文档元素视图属性</span></a></li><li><a href="/javascript-guidebook//browser-object-model/window-position/document-view-and-element-view"><span>文档视图和元素视图</span></a></li><li><a href="/javascript-guidebook//browser-object-model/window-position/mouse-position"><span>鼠标位置</span></a></li></ul></li><li><a href="/javascript-guidebook//browser-object-model/binary-data-and-files">二进制数据和文件 API</a><ul><li><a href="/javascript-guidebook//browser-object-model/binary-data-and-files/local-files-application"><span>本地文件应用</span></a></li><li><a href="/javascript-guidebook//browser-object-model/binary-data-and-files/blob"><span>Blob API</span></a></li><li><a href="/javascript-guidebook//browser-object-model/binary-data-and-files/file"><span>File API</span></a></li><li><a href="/javascript-guidebook//browser-object-model/binary-data-and-files/file-list"><span>FileList API</span></a></li><li><a href="/javascript-guidebook//browser-object-model/binary-data-and-files/file-reader"><span>FileReader API</span></a></li><li><a href="/javascript-guidebook//browser-object-model/binary-data-and-files/file-reader-sync"><span>FileReaderSync API</span></a></li><li><a href="/javascript-guidebook//browser-object-model/binary-data-and-files/url"><span>URL API</span></a></li><li><a href="/javascript-guidebook//browser-object-model/binary-data-and-files/form-data"><span>FormData API</span></a></li></ul></li><li><a href="/javascript-guidebook//browser-object-model/connectivity">数据通信 API</a><ul><li><a href="/javascript-guidebook//browser-object-model/connectivity/post-message"><span>PostMessage</span></a></li><li><a href="/javascript-guidebook//browser-object-model/connectivity/xmlhttprequest"><span>XHMLHttpRequest API</span></a></li><li><a href="/javascript-guidebook//browser-object-model/connectivity/featch"><span>Fetch API</span></a></li><li><a href="/javascript-guidebook//browser-object-model/connectivity/beacon"><span>Beacon API</span></a></li><li><a href="/javascript-guidebook//browser-object-model/connectivity/web-socket"><span>WebSocket</span></a></li><li><a href="/javascript-guidebook//browser-object-model/connectivity/event-source"><span>EventSource</span></a></li><li><a href="/javascript-guidebook//browser-object-model/connectivity/server-sent-events"><span>Server-sent Events</span></a></li><li><a href="/javascript-guidebook//browser-object-model/connectivity/web-real-time-communication"><span>WebRTC</span></a></li><li><a href="/javascript-guidebook//browser-object-model/connectivity/progress-event"><span>Progress Event</span></a></li></ul></li><li><a href="/javascript-guidebook//browser-object-model/offline-and-storage">离线与存储 API</a><ul><li><a href="/javascript-guidebook//browser-object-model/offline-and-storage/browser-cache"><span>浏览器缓存机制</span></a></li><li><a href="/javascript-guidebook//browser-object-model/offline-and-storage/http-cache"><span>HTTP Cache</span></a></li><li><a href="/javascript-guidebook//browser-object-model/offline-and-storage/cookie"><span>Cookie</span></a></li><li><a href="/javascript-guidebook//browser-object-model/offline-and-storage/web-storage"><span>Web Storage</span></a></li><li><a href="/javascript-guidebook//browser-object-model/offline-and-storage/web-workers"><span>Web Workers</span></a></li><li><a href="/javascript-guidebook//browser-object-model/offline-and-storage/service-worker"><span>Service Worker</span></a></li><li><a href="/javascript-guidebook//browser-object-model/offline-and-storage/indexed-db"><span>IndexedDB</span></a></li></ul></li><li><a href="/javascript-guidebook//browser-object-model/performance">性能 API</a><ul><li><a href="/javascript-guidebook//browser-object-model/performance/performance"><span>Performance API</span></a></li><li><a href="/javascript-guidebook//browser-object-model/performance/performance-resource-timing"><span>Performance Resource Timing API</span></a></li><li><a href="/javascript-guidebook//browser-object-model/performance/performance-navigation-timing"><span>Performance Navifation API</span></a></li><li><a href="/javascript-guidebook//browser-object-model/performance/perfromance-timeline"><span>性能时间线</span></a></li></ul></li><li><a href="/javascript-guidebook//browser-object-model/multimedia">多媒体 API</a><ul><li><a href="/javascript-guidebook//browser-object-model/multimedia/audio"><span>音频 Web Audio API</span></a></li><li><a href="/javascript-guidebook//browser-object-model/multimedia/video"><span>视频 Web Video API</span></a></li></ul></li><li><a href="/javascript-guidebook//browser-object-model/device">设备 API</a><ul><li><a href="/javascript-guidebook//browser-object-model/device/geolocation"><span>地理定位 Geolocation API</span></a></li><li><a href="/javascript-guidebook//browser-object-model/device/camera"><span>摄录设备</span></a></li><li><a href="/javascript-guidebook//browser-object-model/device/position"><span>位置信息 Position API</span></a></li></ul></li><li><a href="/javascript-guidebook//browser-object-model/integration">集成 API</a><ul><li><a href="/javascript-guidebook//browser-object-model/integration/full-screen"><span>全屏 Fullscreen API</span></a></li></ul></li><li><a aria-current="page" class="active" href="/javascript-guidebook//browser-object-model/observer">监视 API</a><ul><li><a aria-current="page" class="active" href="/javascript-guidebook//browser-object-model/observer/intersection-observer"><span>IntersectionObserver API</span></a></li><li><a href="/javascript-guidebook//browser-object-model/observer/mutation-observer"><span>MutationObserver API</span></a></li></ul></li><li><a href="/javascript-guidebook//browser-object-model/browser-working-principle">浏览器工作原理</a><ul><li><a href="/javascript-guidebook//browser-object-model/browser-working-principle/browser-architecture"><span>浏览器架构</span></a></li><li><a href="/javascript-guidebook//browser-object-model/browser-working-principle/workflow"><span>渲染进程的内部机制</span></a></li><li><a href="/javascript-guidebook//browser-object-model/browser-working-principle/construction-of-the-object-model"><span>构建对象模型</span></a></li><li><a href="/javascript-guidebook//browser-object-model/browser-working-principle/script-loading-asynchronously"><span>脚本异步加载</span></a></li><li><a href="/javascript-guidebook//browser-object-model/browser-working-principle/construction-of-render-tree"><span>渲染树构建</span></a></li><li><a href="/javascript-guidebook//browser-object-model/browser-working-principle/layout"><span>布局</span></a></li><li><a href="/javascript-guidebook//browser-object-model/browser-working-principle/paint"><span>绘制</span></a></li><li><a href="/javascript-guidebook//browser-object-model/browser-working-principle/composite"><span>合并</span></a></li><li><a href="/javascript-guidebook//browser-object-model/browser-working-principle/browser-event"><span>浏览器事件处理</span></a></li></ul></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="API" data-depth="2" class=""><a href="/javascript-guidebook//browser-object-model/observer/intersection-observer#api"><span>API</span></a></li><li title="callback 参数" data-depth="2" class=""><a href="/javascript-guidebook//browser-object-model/observer/intersection-observer#callback-参数"><span>callback 参数</span></a></li><li title="IntersectionObserverEntry 对象" data-depth="2" class=""><a href="/javascript-guidebook//browser-object-model/observer/intersection-observer#intersectionobserverentry-对象"><span>IntersectionObserverEntry 对象</span></a></li><li title="应用" data-depth="2" class=""><a href="/javascript-guidebook//browser-object-model/observer/intersection-observer#应用"><span>应用</span></a></li><li title="惰性加载" data-depth="3" class=""><a href="/javascript-guidebook//browser-object-model/observer/intersection-observer#惰性加载"><span>惰性加载</span></a></li><li title="无限滚动" data-depth="3" class=""><a href="/javascript-guidebook//browser-object-model/observer/intersection-observer#无限滚动"><span>无限滚动</span></a></li><li title="Option 对象" data-depth="2" class=""><a href="/javascript-guidebook//browser-object-model/observer/intersection-observer#option-对象"><span>Option 对象</span></a></li><li title="threshold 属性" data-depth="3" class=""><a href="/javascript-guidebook//browser-object-model/observer/intersection-observer#threshold-属性"><span>threshold 属性</span></a></li><li title="root 和 rootMargin 属性" data-depth="3" class=""><a href="/javascript-guidebook//browser-object-model/observer/intersection-observer#root-和-rootmargin-属性"><span>root 和 rootMargin 属性</span></a></li><li title="注意点" data-depth="2" class=""><a href="/javascript-guidebook//browser-object-model/observer/intersection-observer#注意点"><span>注意点</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="intersectionobserver-api"><a aria-hidden="true" href="#intersectionobserver-api"><span class="icon icon-link"></span></a>IntersectionObserver API</h1><p>网页开发时，常常需要了解某个元素是否进入了「视口」（Viewport），即用户能不能看到它。</p><p>传统的实现方法是，监听到 <code>scroll</code> 事件后，调用目标元素的 <code>getBoundingClientRect()</code> 方法，得到它对应于视口左上角的坐标，再判断是否在视口之内。这种方法的缺点是，由于 <code>scroll</code> 事件密集发生，计算量很大，容易造成性能问题。</p><p>目前有个新的 IntersectionObserver API，可以自动观察元素是否可见，Chrome 51+ 已经支持。由于可见（visible）的本质是，目标元素与视口产生一个交叉区，所以这个 API 叫做 <strong>交叉视察器</strong>。</p><h2 id="api"><a aria-hidden="true" href="#api"><span class="icon icon-link"></span></a>API</h2><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const io = new IntersectionObserver(callback, option);
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> io </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token plain">callback</span><span class="token punctuation">,</span><span class="token plain"> option</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>IntersectionObserver 是浏览器原生提供的构造函数，接受两个参数：</p><ul><li><code>callback</code>：可见性变化时的回调函数</li><li><code>option</code>：配置对象（可选）</li></ul><p>构造函数的返回值是一个观察器实例，实例的 <code>observe</code> 方法可以指定观察哪个 DOM 节点。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// 开始观察
io.observe(document.getElementById(&#x27;example&#x27;));

// 停止观察
io.unobserve();

// 关闭观察器
io.disconnect();
" data-status="copy"></button><div class="token-line"><span class="token comment">// 开始观察</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">io</span><span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&#x27;example&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 停止观察</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">io</span><span class="token punctuation">.</span><span class="token method function property-access">unobserve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 关闭观察器</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">io</span><span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>上图代码中，<code>observe</code> 的参数是一个 DOM 节点对象。如果要观察多个节点，就要多次调用这个方法。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="io.observe(elementA);
io.observe(elementB);
" data-status="copy"></button><div class="token-line"><span class="token plain">io</span><span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span><span class="token plain">elementA</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">io</span><span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span><span class="token plain">elementB</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="callback-参数"><a aria-hidden="true" href="#callback-参数"><span class="icon icon-link"></span></a>callback 参数</h2><p>目标元素的可见性变化时，就会调用观察器的回调函数 <code>callback</code>。</p><p><code>callback</code> 一般会出发两次。一次是目标元素刚刚进入视口（开始可见），另一次是完全离开视口（开始不可见）。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const io = new IntersectionObserver(entries =&gt; console.log(entries));
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> io </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token parameter">entries</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">entries</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>上述代码中，回调函数采用的是箭头函数的写法。<code>callback</code> 函数的参数（<code>entries</code>）是一个数组，每个成员都是一个 IntersectionObserverEntry 对象。举例来说，如果同时有两个被观察的对象的可见性发生变化，<code>entries</code> 数组就会有两个成员。</p><h2 id="intersectionobserverentry-对象"><a aria-hidden="true" href="#intersectionobserverentry-对象"><span class="icon icon-link"></span></a>IntersectionObserverEntry 对象</h2><p>IntersectionObserverEntry 对象提供目标元素的信息，一共有六个属性。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="{
  time: 3893.92,
  rootBounds: ClientRect {
    bottom: 920,
    height: 1024,
    left: 0,
    right: 1024,
    top: 0,
    width: 920
  },
  boundingClientRect: ClientRect {
    // ...
  },
  intersectionRect: ClientRect {
    // ...
  },
  intersectionRatio: 0.54,
  target: element
}
" data-status="copy"></button><div class="token-line"><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  time</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">3893.92</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  rootBounds</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">ClientRect</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    bottom</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">920</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    height</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1024</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    left</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    right</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1024</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    top</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    width</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">920</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  boundingClientRect</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">ClientRect</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  intersectionRect</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">ClientRect</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  intersectionRatio</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0.54</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  target</span><span class="token punctuation">:</span><span class="token plain"> element</span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>每个属性的含义如下：</p><ul><li><code>time</code>：可见性发生变化的时间，是一个高精度时间戳，单位为毫秒</li><li><code>target</code>：被观察的目标元素，是一个 DOM 节点对象</li><li><code>rootBounds</code>：根元素的矩形区域的信息，<code>getBoundingClientRect()</code> 方法的返回值，如果没有根元素（即直接相对于视口滚动），则返回 <code>null</code></li><li><code>boundingClientRect</code>：目标元素的矩形区域的信息</li><li><code>intersectionRect</code>：目标元素与视口（或根元素）的交叉区域的信息</li><li><code>intersectionRatio</code>：目标元素的可见比例，即 intersectionRect 占 boundingClientRect 的比例，完全可见时为 1，完全不可见时小于等于 0</li></ul></div><img alt="clientX/clientY" src="/javascript-guidebook/static/intersection-observer-viewport.e3f90b25.png" width="800"/><div class="markdown"><h2 id="应用"><a aria-hidden="true" href="#应用"><span class="icon icon-link"></span></a>应用</h2><h3 id="惰性加载"><a aria-hidden="true" href="#惰性加载"><span class="icon icon-link"></span></a>惰性加载</h3><p>静态资源当用户向下滚动时，进入视口才加载，这样可以节省带宽，提高网页性能。这就叫做 <strong>惰性加载</strong>。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function query(selector) {
  return Array.from(document.querySelectorAll(selector));
}

const observer = new IntersectionObserver(entries =&gt; {
  entries.forEach(function(entry) {
    // 观察对象
    const container = entry.target;
    const content = container.querySelector(&#x27;template&#x27;).content;
    container.appendChild(content);
    observer.unobserve(container);
  });
});

query(&#x27;.lazy-loaded&#x27;).forEach(function(item) {
  observer.observe(item);
});
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">query</span><span class="token punctuation">(</span><span class="token parameter">selector</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token punctuation">.</span><span class="token keyword module">from</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelectorAll</span><span class="token punctuation">(</span><span class="token plain">selector</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> observer </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token parameter">entries</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  entries</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 观察对象</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> container </span><span class="token operator">=</span><span class="token plain"> entry</span><span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> content </span><span class="token operator">=</span><span class="token plain"> container</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;template&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">content</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    container</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span><span class="token plain">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    observer</span><span class="token punctuation">.</span><span class="token method function property-access">unobserve</span><span class="token punctuation">(</span><span class="token plain">container</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&#x27;.lazy-loaded&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  observer</span><span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span><span class="token plain">item</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>上述代码，当目标区域可见时，才会将模版内容给你插入真实 DOM，从而引发静态资源的加载。</p><h3 id="无限滚动"><a aria-hidden="true" href="#无限滚动"><span class="icon icon-link"></span></a>无限滚动</h3><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const io = new IntersectionObserver(entries =&gt; {
  // 如果不可见，就返回
  if (entries[0].intersectionRatio &lt;= 0) return;

  loadItems(10);

  console.log(&#x27;Loaded new items&#x27;);
});

// 开始观察
intersectionObserver.observe(document.querySelector(&#x27;.scrollFooter&#x27;));
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> io </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token parameter">entries</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 如果不可见，就返回</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">entries</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">intersectionRatio</span><span class="token plain"> </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">loadItems</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;Loaded new items&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 开始观察</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">intersectionObserver</span><span class="token punctuation">.</span><span class="token method function property-access">observe</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;.scrollFooter&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>无限滚动时，最好在页面底部有个页尾栏（又称 sentinels）。一旦页尾栏可见，就表示用户到达了页面底部，从而加载新的条目放在页尾栏前面。这样做的好处是，不需要再次调用 <code>observe()</code> 方法，现有的 IntersectionObserver 可以保持使用。</p><h2 id="option-对象"><a aria-hidden="true" href="#option-对象"><span class="icon icon-link"></span></a>Option 对象</h2><p>IntersectionObserver 构造函数的第二个参数是个配置对象，它可以设置以下属性。</p><h3 id="threshold-属性"><a aria-hidden="true" href="#threshold-属性"><span class="icon icon-link"></span></a>threshold 属性</h3><p><code>threshold</code> 属性决定了什么时候出发回调函数。它是一个数组，每个成员都是一个门槛值，默认为 <code>[0]</code>，即交叉比例（<code>intersectionRatio</code>）达到 0 时触发回调函数。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="new IntersectionObserver(entries =&gt; {}, {
  threshold: [0, 0.25, 0.5, 0.75, 1],
});
" data-status="copy"></button><div class="token-line"><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token parameter">entries</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  threshold</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">0.25</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">0.75</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>用户可以自定义个数组。比如 <code>[0, 0.25, 0.5, 0.75, 1]</code> 就表示当目标元素 0%、25%、50%、75%、100% 可见时，会触发回调函数。</p><h3 id="root-和-rootmargin-属性"><a aria-hidden="true" href="#root-和-rootmargin-属性"><span class="icon icon-link"></span></a>root 和 rootMargin 属性</h3><p>很多时候，目标元素不仅会随着窗口滚动，还会在容器里面滚动（比如在 iframe 窗口里滚动）。容器内滚动也会影响目标元素的可见性，参见本文开始时的那张示意图。</p><p>IntersectionObserver API 支持容器内滚动。<code>root</code> 属性指定目标元素所在的容器节点（即根元素）。注意，容器元素必须是目标元素的祖先节点。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const opts = {
  root: document.querySelector(&#x27;.container&#x27;),
  rootMargin: &#x27;500px 0px&#x27;,
};

const observer = new IntersectionObserver(callback, opts);
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> opts </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  root</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;.container&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  rootMargin</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;500px 0px&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> observer </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token plain">callback</span><span class="token punctuation">,</span><span class="token plain"> opts</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>上面代码中，除了 <code>root</code> 属性，还有 <code>rootMargin</code> 属性。后者定义根元素的 <code>margin</code>，用来扩展或缩小 <code>rootBounds</code> 这个矩形的大小，从而影响 <code>intersectionRect</code> 交叉区域的大小。它使用 CSS 的定义方法，比如 <code>10px 20px 30px 40px</code>，表示 top、right、bottom 和 left 四个方向的值。</p><p>这样设置以后，不管是窗口滚动或者容器内滚动，只要目标元素可见性变化，都会触发观察器。</p><h2 id="注意点"><a aria-hidden="true" href="#注意点"><span class="icon icon-link"></span></a>注意点</h2><p>IntersectionObserver API 是异步的，不随着目标元素的滚动同步触发。</p><p>规格写明，IntersectionObserver 的实现，应该采用 <code>requestIdleCallback()</code>，即只有线程空闲下来，才会执行观察器。这意味着，这个观察器的优先级非常低，只有其他任务执行完，浏览器有了空闲才会执行。</p><hr/><p><strong>参考资料：</strong></p><ul><li><a href="http://www.ruanyifeng.com/blog/2016/11/intersectionobserver_api.html" target="_blank" rel="noopener noreferrer">IntersectionObserver API 使用教程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://segmentfault.com/a/1190000021069054" target="_blank" rel="noopener noreferrer">📝 IntersectionObserver 是什么<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/javascript-guidebook/edit/master/docs/browser-object-model/observer/intersection-observer.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">10/2/2020, 2:13:31 PM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/javascript-guidebook/umi.js"></script>
    <script src="/javascript-guidebook/docs__browser-object-model__observer__intersection-observer.md.js"></script>
  </body>
</html>
