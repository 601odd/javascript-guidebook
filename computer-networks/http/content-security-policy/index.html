<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/javascript-guidebook/umi.css" />
    <script>
      window.routerBase = "/javascript-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.20
    </script>
    <title>HTTP CSP 内容安全策略</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/javascript-guidebook-favicon.png&#x27;)" href="/javascript-guidebook//">JavaScript Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/javascript-guidebook//basic-concept">基本语法</a><a href="/javascript-guidebook//standard-built-in-objects">内置对象</a><a href="/javascript-guidebook//core-modules">核心模块</a><a href="/javascript-guidebook//object-oriented-programming">OOP</a><a href="/javascript-guidebook//browser-object-model">BOM</a><a href="/javascript-guidebook//document-object-model">DOM</a><a aria-current="page" class="active" href="/javascript-guidebook//computer-networks">计算机网络</a><a href="/javascript-guidebook//design-patterns">设计模式</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/javascript-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/javascript-guidebook-favicon.png&#x27;)" href="/javascript-guidebook//"></a><h1>JavaScript Guidebook</h1><p>JavaScript 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/javascript-guidebook//basic-concept">基本语法</a></li><li><a href="/javascript-guidebook//standard-built-in-objects">内置对象</a></li><li><a href="/javascript-guidebook//core-modules">核心模块</a></li><li><a href="/javascript-guidebook//object-oriented-programming">OOP</a></li><li><a href="/javascript-guidebook//browser-object-model">BOM</a></li><li><a href="/javascript-guidebook//document-object-model">DOM</a></li><li><a aria-current="page" class="active" href="/javascript-guidebook//computer-networks">计算机网络</a></li><li><a href="/javascript-guidebook//design-patterns">设计模式</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/javascript-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/javascript-guidebook//computer-networks">计算机网络</a></li><li><a href="/javascript-guidebook//computer-networks/computer-network-architecture">计算机网络体系</a><ul><li><a href="/javascript-guidebook//computer-networks/computer-network-architecture/computer-networks"><span>计算机网络体系</span></a></li><li><a href="/javascript-guidebook//computer-networks/computer-network-architecture/transport-layer-protocol"><span>传输层协议</span></a></li><li><a href="/javascript-guidebook//computer-networks/computer-network-architecture/network-layer-and-data-link-layer-protocol"><span>网络层与数据链路层协议</span></a></li><li><a href="/javascript-guidebook//computer-networks/computer-network-architecture/dns"><span>DNS 域名解析系统</span></a></li><li><a href="/javascript-guidebook//computer-networks/computer-network-architecture/cdn"><span>CDN 内容分发网络</span></a></li></ul></li><li><a aria-current="page" class="active" href="/javascript-guidebook//computer-networks/http">HTTP</a><ul><li><a href="/javascript-guidebook//computer-networks/http/http"><span>HTTP</span></a></li><li><a href="/javascript-guidebook//computer-networks/http/https"><span>HTTPS</span></a></li><li><a href="/javascript-guidebook//computer-networks/http/headers"><span>HTTP 首部字段</span></a></li><li><a href="/javascript-guidebook//computer-networks/http/request-methods"><span>HTTP 请求方法</span></a></li><li><a href="/javascript-guidebook//computer-networks/http/status-code"><span>HTTP 响应状态码</span></a></li><li><a href="/javascript-guidebook//computer-networks/http/cors"><span>HTTP CORS 跨域资源共享</span></a></li><li><a aria-current="page" class="active" href="/javascript-guidebook//computer-networks/http/content-security-policy"><span>HTTP CSP 内容安全策略</span></a></li><li><a href="/javascript-guidebook//computer-networks/http/authentication"><span>HTTP 身份校验</span></a></li><li><a href="/javascript-guidebook//computer-networks/http/http2"><span>HTTP2</span></a></li><li><a href="/javascript-guidebook//computer-networks/http/http3"><span>HTTP3</span></a></li></ul></li><li><a href="/javascript-guidebook//computer-networks/web-security">Web 安全</a><ul><li><a href="/javascript-guidebook//computer-networks/web-security/same-origin-policy"><span>同源策略</span></a></li><li><a href="/javascript-guidebook//computer-networks/web-security/xss"><span>XSS 跨站脚本攻击</span></a></li><li><a href="/javascript-guidebook//computer-networks/web-security/csrf"><span>CSRF 跨站点请求伪造攻击</span></a></li><li><a href="/javascript-guidebook//computer-networks/web-security/ddos"><span>DDoS 攻击</span></a></li><li><a href="/javascript-guidebook//computer-networks/web-security/sql-injection"><span>SQL 注入攻击</span></a></li><li><a href="/javascript-guidebook//computer-networks/web-security/hijacking"><span>流量劫持</span></a></li></ul></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="指令选项" data-depth="2" class=""><a href="/javascript-guidebook//computer-networks/http/content-security-policy#指令选项"><span>指令选项</span></a></li><li title="资源加载指令" data-depth="3" class=""><a href="/javascript-guidebook//computer-networks/http/content-security-policy#资源加载指令"><span>资源加载指令</span></a></li><li title="default-src" data-depth="3" class=""><a href="/javascript-guidebook//computer-networks/http/content-security-policy#default-src"><span>default-src</span></a></li><li title="其他限制" data-depth="3" class=""><a href="/javascript-guidebook//computer-networks/http/content-security-policy#其他限制"><span>其他限制</span></a></li><li title="report-uri" data-depth="3" class=""><a href="/javascript-guidebook//computer-networks/http/content-security-policy#report-uri"><span>report-uri</span></a></li><li title="选项值" data-depth="2" class=""><a href="/javascript-guidebook//computer-networks/http/content-security-policy#选项值"><span>选项值</span></a></li><li title="script-src 的特殊值" data-depth="2" class=""><a href="/javascript-guidebook//computer-networks/http/content-security-policy#script-src-的特殊值"><span>script-src 的特殊值</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="http-csp-内容安全策略"><a aria-hidden="true" href="#http-csp-内容安全策略"><span class="icon icon-link"></span></a>HTTP CSP 内容安全策略</h1><p>内容安全策略 (CSP) 是一个额外的安全层，用于检测并削弱某些特定类型的攻击，包括跨站脚本 (XSS) 和数据注入攻击等。无论是数据盗取、网站内容污染还是散发恶意软件，这些攻击都是主要的手段。</p><p>CSP 是一种由开发者定义的安全性政策性申明，通过 CSP 所约束的规则指定可信的内容来源（这里的内容可以指脚本、图片、<code>iframe</code>、<code>font</code>、<code>style</code> 等等可能的远程的资源）。通过 CSP 协定，让 Web 处于一个安全的运行环境中。</p><p>为使 CSP 可用，需要配置网络服务器返回 <code>Content-Security-Policy</code> HTTP 头部。</p><p>除此之外，<code>&lt;meta&gt;</code> 元素也可以用于配置该策略：</p><div class="__dumi-default-code-block"><pre class="prism-code language-html"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="&lt;meta http-equiv=&quot;Content-Security-Policy&quot; /&gt;
" data-status="copy"></button><div class="token-line"><span class="token tag punctuation">&lt;</span><span class="token tag">meta</span><span class="token tag"> </span><span class="token tag attr-name">http-equiv</span><span class="token tag attr-value punctuation">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">Content-Security-Policy</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="指令选项"><a aria-hidden="true" href="#指令选项"><span class="icon icon-link"></span></a>指令选项</h2><h3 id="资源加载指令"><a aria-hidden="true" href="#资源加载指令"><span class="icon icon-link"></span></a>资源加载指令</h3><p>通过获取指令来控制某些可能被加载的确切的资源类型的位置：</p><p>CSP 策略在默认的情况下是不允许使用 <code>data URIs</code> 资源的，如果要使用，那么需要显示的指定：</p><ul><li><code>script-src</code>：在处理脚本资源的时候设置 <code>unsafe-inline</code> 可以阻止内联 Js 代码的执行，使用 <code>unsafe-eval</code> 开关可以禁止 <code>eval</code>、<code>setTimeout</code>、<code>setInterval</code> 函数的执行</li><li><code>style-src</code>：会控制样式表@import 和 rel 时所引入的 URI 资源，设置 unsafe-inline 规则可以是浏览器拒绝解析内部样式和内联样式定义。并不会阻止链入外部样式表。</li><li><code>img-src</code>：可以控制图片资源的连接，包括 <code>img</code> 标签的 <code>src</code> 属性，以及 CSS3 中的 <code>url()</code> 和 <code>image()</code> 方法，以及 <code>link</code> 标签中的 <code>href</code> 属性（当 <code>rel</code> 设置成与图像相关的值，比如 HTML 支持的 icon）</li><li><code>font-src</code>：控制 CSS 中的 <code>@font-face</code> 加载的字体源地址</li><li><code>frame-src</code>：设置允许通过类似 <code>&lt;frame&gt;</code> 和 <code>&lt;iframe&gt;</code> 标签加载的内嵌内容的源地址</li><li><code>manifest-src</code>：限制应用声明文件的源地址</li><li><code>media-src</code>：控制媒体类型的外部链入资源，如 <code>&lt;audio&gt;</code>、<code>&lt;video&gt;</code>、<code>&lt;source&gt;</code> 和 <code>&lt;track&gt;</code> 标签的 <code>src</code> 属性</li><li><code>object-src</code>：控制 <code>&lt;embed&gt;</code>、<code>&lt;code&gt;</code>、<code>&lt;archive&gt;</code>、<code>&lt;applet&gt;</code> 等对象</li><li><code>prefetch-src</code>：指定预加载或预渲染的允许源地址</li><li><code>connect-src</code>：控制 XMLHttpRequest 中的 <code>open()</code>、WebSocket、EventSource</li></ul><p>另外 <code>inline script</code> 和 <code>eval</code> 类型函数（包括 <code>eval</code>、<code>setInterval</code>、<code>setTimeout</code> 和 <code>new Function()</code>）也是不被执行的。</p><h3 id="default-src"><a aria-hidden="true" href="#default-src"><span class="icon icon-link"></span></a>default-src</h3><p><code>default-src</code> 用于设置上面各个选项的默认值。</p><div class="__dumi-default-code-block"><pre class="prism-code language-http"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Content-Security-Policy: default-src &#x27;self&#x27;
" data-status="copy"></button><div class="token-line"><span class="token header-name keyword">Content-Security-Policy:</span><span class="token plain"> default-src &#x27;self&#x27;</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>上面代码限制所有外部资源，只能从当前渔民该加载。</p><p>如果同时设置某个单项限制（比如 <code>font-src</code>）和 <code>default-src</code>，前者会覆盖后者，即字体文件会采用 <code>font-src</code> 的值，其他资源依然采用 <code>default-src</code> 的值。</p><h3 id="其他限制"><a aria-hidden="true" href="#其他限制"><span class="icon icon-link"></span></a>其他限制</h3><p>其他一些安全相关的功能，也放在了 CSP 里面：</p><ul><li><code>block-all-mixed-content</code>：HTTPS 网页不得加载 HTTP 资源（浏览器已经默认开启）</li><li><code>upgrade-insecure-requests</code>：自动将网页上所有加载外部资源的 HTTP 链接换成 HTTPS 协议</li><li><code>plugin-types</code>：限制可以使用的插件格式</li><li><code>sandbox</code>：浏览器行为的限制，比如不能有弹出窗口等。</li></ul><h3 id="report-uri"><a aria-hidden="true" href="#report-uri"><span class="icon icon-link"></span></a>report-uri</h3><p>有时，我们不仅希望防止 XSS，还希望记录此类行为。<code>report-uri</code> 就用来告诉浏览器，应该把注入行为报告给哪个网址。</p><div class="__dumi-default-code-block"><pre class="prism-code language-http"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Content-Security-Policy: default-src &#x27;self&#x27;; ...; report-uri /my_amazing_csp_report_parser;
" data-status="copy"></button><div class="token-line"><span class="token header-name keyword">Content-Security-Policy:</span><span class="token plain"> default-src &#x27;self&#x27;; ...; report-uri /my_amazing_csp_report_parser;</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>上面代码指定，将注入行为报告给 <code>/my_amazing_csp_report_parser</code> 这个 URL。</p><p>浏览器会使用 <code>POST</code> 方法，发送一个 <code>JSON</code> 对象，下面是一个例子。</p><div class="__dumi-default-code-block"><pre class="prism-code language-json"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="{
  &quot;csp-report&quot;: {
    &quot;document-uri&quot;: &quot;http://example.org/page.html&quot;,
    &quot;referrer&quot;: &quot;http://evil.example.com/&quot;,
    &quot;blocked-uri&quot;: &quot;http://evil.example.com/evil.js&quot;,
    &quot;violated-directive&quot;: &quot;script-src &#x27;self&#x27; https://apis.google.com&quot;,
    &quot;original-policy&quot;: &quot;script-src &#x27;self&#x27; https://apis.google.com; report-uri http://example.org/my_amazing_csp_report_parser&quot;
  }
}
" data-status="copy"></button><div class="token-line"><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">&quot;csp-report&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token property">&quot;document-uri&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;http://example.org/page.html&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token property">&quot;referrer&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;http://evil.example.com/&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token property">&quot;blocked-uri&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;http://evil.example.com/evil.js&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token property">&quot;violated-directive&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;script-src &#x27;self&#x27; https://apis.google.com&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token property">&quot;original-policy&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;script-src &#x27;self&#x27; https://apis.google.com; report-uri http://example.org/my_amazing_csp_report_parser&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="选项值"><a aria-hidden="true" href="#选项值"><span class="icon icon-link"></span></a>选项值</h2><p>每个限制选项可以设置以下几种值，这些值就构成了白名单。</p><ul><li><strong>主机名</strong>：<code>example.org</code>、<code>https://example.com:443</code></li><li><strong>路径名</strong>：<code>example.org/resources/js/</code></li><li><strong>通配符</strong>：<code>*.example.org</code>、<code>*://*.example.com:*</code>（表示任意协议、任意子域名、任意端口）</li><li><strong>协议名</strong>：<code>https:</code>、<code>data:</code></li><li><strong>关键字 <code>&#x27;self&#x27;</code></strong>：当前域名，需要加引号</li><li><strong>关键字 <code>&#x27;none&#x27;</code></strong>：禁止加载任何外部资源，需要加引号</li></ul><p>多个值也可以并列，用空格分隔。</p><div class="__dumi-default-code-block"><pre class="prism-code language-http"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Content-Security-Policy: script-src &#x27;self&#x27; https://apis.google.com
" data-status="copy"></button><div class="token-line"><span class="token header-name keyword">Content-Security-Policy:</span><span class="token plain"> script-src &#x27;self&#x27; https://apis.google.com</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>如果同一个限制选项使用多次，只有第一次会生效。</p><div class="__dumi-default-code-block"><pre class="prism-code language-http"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="# 错误的写法
Content-Security-Policy: script-src https://host1.com; script-src https://host2.com

# 正确的写法
Content-Security-Policy: script-src https://host1.com https://host2.com
" data-status="copy"></button><div class="token-line"><span class="token plain"># 错误的写法</span></div><div class="token-line"><span class="token plain"></span><span class="token header-name keyword">Content-Security-Policy:</span><span class="token plain"> script-src https://host1.com; script-src https://host2.com</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"># 正确的写法</span></div><div class="token-line"><span class="token plain"></span><span class="token header-name keyword">Content-Security-Policy:</span><span class="token plain"> script-src https://host1.com https://host2.com</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="script-src-的特殊值"><a aria-hidden="true" href="#script-src-的特殊值"><span class="icon icon-link"></span></a>script-src 的特殊值</h2><p>除了常规值，<code>script-src</code> 还可以设置一些特殊值。注意，下面这些值都必须放在单引号里面。</p><ul><li><code>unsafe-inline</code>：允许执行页面内嵌的 <code>&amp;lt;script&gt;</code> 标签和事件监听函数</li><li><code>unsafe-eval</code>：允许将字符串当作代码执行，比如使用 <code>eval</code>、<code>setTimeout</code>、<code>setInterval</code> 和 <code>Function</code> 等函数。</li><li><code>nonce</code> 值：每次 HTTP 回应给出一个授权 token，页面内嵌脚本必须有这个 token，才会执行</li><li><code>hash</code> 值：列出允许执行的脚本代码的 Hash 值，页面内嵌脚本的哈希值只有吻合的情况下，才能执行。</li></ul><p><code>nonce</code> 值的例子如下，服务器发送网页的时候，告诉浏览器一个随机生成的 <code>token</code>。</p><div class="__dumi-default-code-block"><pre class="prism-code language-http"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Content-Security-Policy: script-src &#x27;nonce-EDNnf03nceIOfn39fn3e9h3sdfa&#x27;
" data-status="copy"></button><div class="token-line"><span class="token header-name keyword">Content-Security-Policy:</span><span class="token plain"> script-src &#x27;nonce-EDNnf03nceIOfn39fn3e9h3sdfa&#x27;</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>页面内嵌脚本，必须有这个 token 才能执行。</p><div class="__dumi-default-code-block"><pre class="prism-code language-html"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="&lt;script nonce=&quot;EDNnf03nceIOfn39fn3e9h3sdfa&quot;&gt;
  // some code
&lt;/script&gt;
" data-status="copy"></button><div class="token-line"><span class="token tag punctuation">&lt;</span><span class="token tag">script</span><span class="token tag"> </span><span class="token tag attr-name">nonce</span><span class="token tag attr-value punctuation">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">EDNnf03nceIOfn39fn3e9h3sdfa</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token script language-javascript"></span></div><div class="token-line"><span class="token script language-javascript">  </span><span class="token script language-javascript comment">// some code</span><span class="token script language-javascript"></span></div><div class="token-line"><span class="token script language-javascript"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">script</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>hash</code> 值的例子如下，服务器给出一个允许执行的代码的 <code>hash</code> 值。</p><div class="__dumi-default-code-block"><pre class="prism-code language-http"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Content-Security-Policy: script-src &#x27;sha256-qznLcsROx4GACP2dm0UCKCzCG-HiZ1guq6ZZDob_Tng=&#x27;
" data-status="copy"></button><div class="token-line"><span class="token header-name keyword">Content-Security-Policy:</span><span class="token plain"> script-src &#x27;sha256-qznLcsROx4GACP2dm0UCKCzCG-HiZ1guq6ZZDob_Tng=&#x27;</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>下面的代码就会允许执行，因为 hash 值相符。</p><div class="__dumi-default-code-block"><pre class="prism-code language-html"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="&lt;script type=&quot;text/javascript&quot;&gt;
  alert(&#x27;Hello, world.&#x27;);
&lt;/script&gt;
" data-status="copy"></button><div class="token-line"><span class="token tag punctuation">&lt;</span><span class="token tag">script</span><span class="token tag"> </span><span class="token tag attr-name">type</span><span class="token tag attr-value punctuation">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">text/javascript</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token script language-javascript"></span></div><div class="token-line"><span class="token script language-javascript">  </span><span class="token script language-javascript function">alert</span><span class="token script language-javascript punctuation">(</span><span class="token script language-javascript string">&#x27;Hello, world.&#x27;</span><span class="token script language-javascript punctuation">)</span><span class="token script language-javascript punctuation">;</span><span class="token script language-javascript"></span></div><div class="token-line"><span class="token script language-javascript"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">script</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>注意，计算 <code>hash</code> 值的时候，<code>&lt;script&gt;</code> 标签不算在内。</p><p>除了 <code>script-src</code> 选项，<code>nonce</code> 值和 <code>hash</code> 值还可以用在 <code>style-src</code> 选项，控制页面内嵌的样式表。</p><hr/><p><strong>参考资料：</strong></p><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP" target="_blank" rel="noopener noreferrer">📖 内容安全策略（CSP）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="http://www.ruanyifeng.com/blog/2016/09/csp.html" target="_blank" rel="noopener noreferrer">📝 Content Security Policy 入门教程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://www.zhihu.com/question/21979782" target="_blank" rel="noopener noreferrer">📝 Content Security Policy（CSP）是什么？为什么它能抵御 XSS 攻击？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/javascript-guidebook/edit/master/docs/computer-networks/http/content-security-policy.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">9/17/2020, 3:02:22 PM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/javascript-guidebook/umi.js"></script>
    <script src="/javascript-guidebook/docs__computer-networks__http__content-security-policy.md.js"></script>
  </body>
</html>
