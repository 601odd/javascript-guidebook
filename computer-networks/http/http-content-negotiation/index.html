<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/javascript-guidebook/umi.css" />
    <script>
      window.routerBase = "/javascript-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.22
    </script>
    <title>HTTP 内容协商</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/javascript-guidebook-favicon.png&#x27;)" href="/javascript-guidebook//">JavaScript Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/javascript-guidebook//basic-concept">基本语法</a><a href="/javascript-guidebook//standard-built-in-objects">内置对象</a><a href="/javascript-guidebook//core-modules">核心模块</a><a href="/javascript-guidebook//object-oriented-programming">OOP</a><a href="/javascript-guidebook//browser-object-model">BOM</a><a href="/javascript-guidebook//document-object-model">DOM</a><a aria-current="page" class="active" href="/javascript-guidebook//computer-networks">计算机网络</a><a href="/javascript-guidebook//design-patterns">设计模式</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/javascript-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/javascript-guidebook-favicon.png&#x27;)" href="/javascript-guidebook//"></a><h1>JavaScript Guidebook</h1><p>JavaScript 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/javascript-guidebook//basic-concept">基本语法</a></li><li><a href="/javascript-guidebook//standard-built-in-objects">内置对象</a></li><li><a href="/javascript-guidebook//core-modules">核心模块</a></li><li><a href="/javascript-guidebook//object-oriented-programming">OOP</a></li><li><a href="/javascript-guidebook//browser-object-model">BOM</a></li><li><a href="/javascript-guidebook//document-object-model">DOM</a></li><li><a aria-current="page" class="active" href="/javascript-guidebook//computer-networks">计算机网络</a></li><li><a href="/javascript-guidebook//design-patterns">设计模式</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/javascript-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/javascript-guidebook//computer-networks">计算机网络</a></li><li><a href="/javascript-guidebook//computer-networks/computer-network-architecture">计算机网络体系</a><ul><li><a href="/javascript-guidebook//computer-networks/computer-network-architecture/computer-networks"><span>计算机网络体系</span></a></li><li><a href="/javascript-guidebook//computer-networks/computer-network-architecture/transport-layer-protocol"><span>传输层协议</span></a></li><li><a href="/javascript-guidebook//computer-networks/computer-network-architecture/network-layer-and-data-link-layer-protocol"><span>网络层与数据链路层协议</span></a></li><li><a href="/javascript-guidebook//computer-networks/computer-network-architecture/dns"><span>DNS 域名解析系统</span></a></li><li><a href="/javascript-guidebook//computer-networks/computer-network-architecture/cdn"><span>CDN 内容分发网络</span></a></li><li><a href="/javascript-guidebook//computer-networks/computer-network-architecture/hls"><span>HLS 流媒体网络传输协议</span></a></li></ul></li><li><a aria-current="page" class="active" href="/javascript-guidebook//computer-networks/http">HTTP</a><ul><li><a href="/javascript-guidebook//computer-networks/http/http"><span>HTTP</span></a></li><li><a href="/javascript-guidebook//computer-networks/http/http-resource-and-uris"><span>HTTP 资源标识</span></a></li><li><a href="/javascript-guidebook//computer-networks/http/http-message"><span>HTTP 报文格式</span></a></li><li><a href="/javascript-guidebook//computer-networks/http/http-headers"><span>HTTP 首部字段</span></a></li><li><a href="/javascript-guidebook//computer-networks/http/http-status-code"><span>HTTP 状态码</span></a></li><li><a href="/javascript-guidebook//computer-networks/http/http-connection"><span>HTTP 连接</span></a></li><li><a aria-current="page" class="active" href="/javascript-guidebook//computer-networks/http/http-content-negotiation"><span>HTTP 内容协商</span></a></li><li><a href="/javascript-guidebook//computer-networks/http/cross-origin-resource-sharing"><span>HTTP CORS 跨域资源共享</span></a></li><li><a href="/javascript-guidebook//computer-networks/http/content-security-policy"><span>HTTP CSP 内容安全策略</span></a></li><li><a href="/javascript-guidebook//computer-networks/http/https"><span>HTTPS</span></a></li><li><a href="/javascript-guidebook//computer-networks/http/http2"><span>HTTP2</span></a></li><li><a href="/javascript-guidebook//computer-networks/http/http3"><span>HTTP3</span></a></li></ul></li><li><a href="/javascript-guidebook//computer-networks/web-security">Web 安全</a><ul><li><a href="/javascript-guidebook//computer-networks/web-security/same-origin-policy"><span>同源策略</span></a></li><li><a href="/javascript-guidebook//computer-networks/web-security/xss"><span>XSS 跨站脚本攻击</span></a></li><li><a href="/javascript-guidebook//computer-networks/web-security/csrf"><span>CSRF 跨站点请求伪造攻击</span></a></li><li><a href="/javascript-guidebook//computer-networks/web-security/ddos"><span>DDoS 攻击</span></a></li><li><a href="/javascript-guidebook//computer-networks/web-security/sql-injection"><span>SQL 注入攻击</span></a></li><li><a href="/javascript-guidebook//computer-networks/web-security/hijacking"><span>流量劫持</span></a></li></ul></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="基本原则" data-depth="2" class=""><a href="/javascript-guidebook//computer-networks/http/http-content-negotiation#基本原则"><span>基本原则</span></a></li><li title="服务端驱动型内容协商机制" data-depth="3" class=""><a href="/javascript-guidebook//computer-networks/http/http-content-negotiation#服务端驱动型内容协商机制"><span>服务端驱动型内容协商机制</span></a></li><li title="代理驱动型内容协商机制" data-depth="3" class=""><a href="/javascript-guidebook//computer-networks/http/http-content-negotiation#代理驱动型内容协商机制"><span>代理驱动型内容协商机制</span></a></li><li title="常见协商要素" data-depth="2" class=""><a href="/javascript-guidebook//computer-networks/http/http-content-negotiation#常见协商要素"><span>常见协商要素</span></a></li><li title="质量因子" data-depth="3" class=""><a href="/javascript-guidebook//computer-networks/http/http-content-negotiation#质量因子"><span>质量因子</span></a></li><li title="媒体类型" data-depth="3" class=""><a href="/javascript-guidebook//computer-networks/http/http-content-negotiation#媒体类型"><span>媒体类型</span></a></li><li title="编码类型" data-depth="3" class=""><a href="/javascript-guidebook//computer-networks/http/http-content-negotiation#编码类型"><span>编码类型</span></a></li><li title="表述语言" data-depth="3" class=""><a href="/javascript-guidebook//computer-networks/http/http-content-negotiation#表述语言"><span>表述语言</span></a></li><li title="资源表述头部字段" data-depth="2" class=""><a href="/javascript-guidebook//computer-networks/http/http-content-negotiation#资源表述头部字段"><span>资源表述头部字段</span></a></li><li title="媒体类型编码" data-depth="3" class=""><a href="/javascript-guidebook//computer-networks/http/http-content-negotiation#媒体类型编码"><span>媒体类型编码</span></a></li><li title="内容编码" data-depth="3" class=""><a href="/javascript-guidebook//computer-networks/http/http-content-negotiation#内容编码"><span>内容编码</span></a></li><li title="表述语言" data-depth="3" class=""><a href="/javascript-guidebook//computer-networks/http/http-content-negotiation#表述语言-1"><span>表述语言</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="http-内容协商"><a aria-hidden="true" href="#http-内容协商"><span class="icon icon-link"></span></a>HTTP 内容协商</h1><p>在 HTTP 协议中，<strong>内容协商机制</strong> 指通过为相同 URI 指向的资源提供不同的展现形式，可以使用户代理选择与用户需求相适应的最佳匹配（例如：文档使用的自然语言、图片的格式或者内容编码形式）。</p><h2 id="基本原则"><a aria-hidden="true" href="#基本原则"><span class="icon icon-link"></span></a>基本原则</h2></div><img alt="HTTP 内容协商机制的基本原则" src="/javascript-guidebook/static/http-content-negotiation.0d0f8e5d.png" width="520"/><div class="markdown"><p>最佳展示形式的选取可以通过两种机制实现：</p><ul><li>客户端设置特定的 HTTP 首部字段（标准方式）</li><li>服务端返回 300（Multiple Choices）状态码或者 406（Not Acceptable）状态码（备选方案）</li></ul><h3 id="服务端驱动型内容协商机制"><a aria-hidden="true" href="#服务端驱动型内容协商机制"><span class="icon icon-link"></span></a>服务端驱动型内容协商机制</h3></div><img alt="服务端驱动型内容协商机制" src="/javascript-guidebook/static/http-content-negotiation-proactive.83206f77.png" width="520"/><div class="markdown"><p>在服务端驱动型协商机制或者主动协商机制中，浏览器（或者其他任何类型的用户代理）会随同 URL 发送一系列的消息头。这些消息头描述了用户倾向的选择。服务器则以此为线索，通过内部算法来选择最佳方案提供给客户端。</p><h3 id="代理驱动型内容协商机制"><a aria-hidden="true" href="#代理驱动型内容协商机制"><span class="icon icon-link"></span></a>代理驱动型内容协商机制</h3></div><img alt="代理驱动型内容协商机制" src="/javascript-guidebook/static/http-content-negotiation-reactive.8c08e45f.png" width="520"/><div class="markdown"><p>在协商机制中，每一个特性需要对应一个首部。如果想要使用屏幕大小、分辨率或者其他方面的特性，就需要创建一个新的首部。而且在每一次请求中都必须发送这些首部。在首部很少的时候，这并不是问题，但是随着数量的增多，消息体的体积会导致性能的下降。带有精确信息的首部发送的越多，信息熵就会越大，也就准许了更多 HTTP 指纹识别行为，以及与此相关的隐私问题的发生。</p><p>从 HTTP 协议制定之初，该协议就准许另外一种协商机制：代理驱动型内容协商机制，或称为响应式协商机制。</p><p>在这种协商机制中，当面临不明确的请求时，服务器会返回一个页面，其中包含了可供选择的资源的链接。资源呈现给用户，由用户做出选择。</p><p>不幸的是，HTTP 标准没有明确指定提供可选资源链接的页面的格式，这一点阻碍了将这一过程无痛自动化。除了退回至服务端驱动型内容协商机制外，这种自动化方法几乎无一例外都是通过脚本技术来完成的，尤其是 JavaScript 重定向技术：在检测了协商的条件之后，脚本会触发重定向动作。另外一个问题是，为了获得实际的资源，需要额外发送一次请求，减慢了将资源呈现给用户的速度。</p><h2 id="常见协商要素"><a aria-hidden="true" href="#常见协商要素"><span class="icon icon-link"></span></a>常见协商要素</h2><h3 id="质量因子"><a aria-hidden="true" href="#质量因子"><span class="icon icon-link"></span></a>质量因子</h3><p>质量因子 <code>q</code>：内容的质量、可接受类型的优先级</p><ol><li>内容质量。举例，客户端发起一个图片的请求，这个图片只供快速浏览用的，那么就可以做非常高的压缩比，这时的质量 <code>q</code> 就可以比较低。如果这个图片用作医学的，那么 <code>q</code> 就比较大，因为不能容忍医用照片模糊以损失大量的细节。</li><li>可接受类型的优先级。举例：有一个 URI 即支持中文，又支持英文。但是希望优先显示中文，就能用 <code>q</code> 来表示。</li></ol><h3 id="媒体类型"><a aria-hidden="true" href="#媒体类型"><span class="icon icon-link"></span></a>媒体类型</h3><p>媒体资源的 MIME 类型及质量因子</p><div class="__dumi-default-code-block"><pre class="prism-code language-http"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Accept: text/html, application/xhtml+xml,application/xml;q=0.9,_/_;q=0.8
Axxept: text/html, application/xhtml+xml,application/xml;1=0.9,image/webp,image/apng,_/_;q=0.8,application/signed-exchange;v=b3
" data-status="copy"></button><div class="token-line"><span class="token header-name keyword">Accept:</span><span class="token plain"> text/html, application/xhtml+xml,application/xml;q=0.9,_/_;q=0.8</span></div><div class="token-line"><span class="token plain"></span><span class="token header-name keyword">Axxept:</span><span class="token plain"> text/html, application/xhtml+xml,application/xml;1=0.9,image/webp,image/apng,_/_;q=0.8,application/signed-exchange;v=b3</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="编码类型"><a aria-hidden="true" href="#编码类型"><span class="icon icon-link"></span></a>编码类型</h3><p>内容编码：主要指压缩算法</p><div class="__dumi-default-code-block"><pre class="prism-code language-http"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Accept-Encoding: gzip. deflate, br
" data-status="copy"></button><div class="token-line"><span class="token header-name keyword">Accept-Encoding:</span><span class="token plain"> gzip. deflate, br</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="表述语言"><a aria-hidden="true" href="#表述语言"><span class="icon icon-link"></span></a>表述语言</h3><div class="__dumi-default-code-block"><pre class="prism-code language-http"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
" data-status="copy"></button><div class="token-line"><span class="token header-name keyword">Accept-Language:</span><span class="token plain"> zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7</span></div><div class="token-line"><span class="token plain"></span><span class="token header-name keyword">Accept-Language:</span><span class="token plain"> zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="资源表述头部字段"><a aria-hidden="true" href="#资源表述头部字段"><span class="icon icon-link"></span></a>资源表述头部字段</h2><h3 id="媒体类型编码"><a aria-hidden="true" href="#媒体类型编码"><span class="icon icon-link"></span></a>媒体类型编码</h3><div class="__dumi-default-code-block"><pre class="prism-code language-http"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Content-Type: text/html; charSet=utf-8
" data-status="copy"></button><div class="token-line"><span class="token header-name keyword">Content-Type:</span><span class="token plain"> text/html; charSet=utf-8</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="内容编码"><a aria-hidden="true" href="#内容编码"><span class="icon icon-link"></span></a>内容编码</h3><div class="__dumi-default-code-block"><pre class="prism-code language-http"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Content-Encoding: gzip
" data-status="copy"></button><div class="token-line"><span class="token header-name keyword">Content-Encoding:</span><span class="token plain"> gzip</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="表述语言-1"><a aria-hidden="true" href="#表述语言-1"><span class="icon icon-link"></span></a>表述语言</h3><div class="__dumi-default-code-block"><pre class="prism-code language-http"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Content-Language: de-DE, en-CA
" data-status="copy"></button><div class="token-line"><span class="token header-name keyword">Content-Language:</span><span class="token plain"> de-DE, en-CA</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><hr/><p><strong>参考资料：</strong></p><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Content_negotiation" target="_blank" rel="noopener noreferrer">📖 MDN：HTTP 内容协商<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/javascript-guidebook/edit/master/docs/computer-networks/http/http-content-negotiation.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">10/2/2020, 2:13:31 PM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/javascript-guidebook/umi.js"></script>
    <script src="/javascript-guidebook/docs__computer-networks__http__http-content-negotiation.md.js"></script>
  </body>
</html>
